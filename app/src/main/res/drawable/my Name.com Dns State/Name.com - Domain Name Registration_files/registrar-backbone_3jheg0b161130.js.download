CSRF_token=$("meta[name='csrf-token']").attr("content");var oldBackboneSync=Backbone.sync;Backbone.sync=function(c,b,a){a.beforeSend=function(f){f.setRequestHeader("x-csrf-token-auth",CSRF_token)};return oldBackboneSync(c,b,a)};Backbone.wrapError=function(b,c,a){return function(f,g){g=f===c?g:f;if(typeof g.responseText!="undefined"){if(JSON.parse(g.responseText).refresh){setTimeout("refresh();",1000)}if(b){b(c,g,a)}else{c.trigger("error",c,g,a)}}}};Backbone.Paginator=(function(f,a,b){var c={};c.version="0.15";c.requestPager=f.Collection.extend({sync:function(l,i,h){var j=this;a.defaults(j.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10});a.each(j.paginator_ui,function(o,n){if(a.isUndefined(j[n])){j[n]=j.paginator_ui[n]}});var k={};a.each(j.server_api,function(o,n){var p=true;if(a.isFunction(o)){o=a.bind(o,j)}else{if(a.isObject(o)){a.each(o,function(t,q){if(a.isArray(t)){a.each(t,function(v,u){k[n+"["+q+"]["+u+"]"]=v})}else{k[n+"["+q+"]"]=t}},this);p=false}}if(p){k[n]=o}},this);var g=a.clone(j.paginator_core);a.each(g,function(o,n){if(a.isFunction(o)){o=a.bind(o,j)}g[n]=o});g=a.defaults(g,{timeout:25000,cache:false,type:"GET",dataType:"jsonp"});g=a.extend(g,{jsonpCallback:"callback",data:b.param(k),processData:false,url:a.result(g,"url"),beforeSend:function(n){n.setRequestHeader("x-csrf-token-auth",CSRF_token)}},h);return b.ajax(g)},requestNextPage:function(){if(this.currentPage!==undefined){this.currentPage+=1;this.pager()}},requestPreviousPage:function(){if(this.currentPage!==undefined){this.currentPage-=1;this.pager()}},updateOrder:function(g){if(g!==undefined){this.sortField=g;this.pager()}},goTo:function(g){if(g!==undefined){this.currentPage=parseInt(g,10);this.pager()}},howManyPer:function(g){if(g!==undefined){this.currentPage=this.firstPage;this.perPage=g;this.pager()}},sort:function(){},info:function(){var g={currentPage:this.currentPage,firstPage:this.firstPage,totalPages:this.totalPages,lastPage:this.totalPages,perPage:this.perPage};this.information=g;return g},pager:function(){this.fetch({})}});return c}(Backbone,_,jQuery));RegistrarValidation={validation_messages:{validHost:"Invalid Hostname",validUrl:"Valid Url Required",validEmail:"Invalid Email",required:"Required",noSpecialChars:"Invalid entry, no special characters permitted"},validate:function(b,a){if(this[b]){return this[b].apply(this,a)}else{return this.skip.apply(this,a)}},patterns:{email:/^([a-z0-9\+_\-]+)(\.[a-z0-9\+_\-]+)*@([a-z0-9\-]+\.)+[a-z0-9\-]{2,63}$/i,ip:/(([0-2]?\d{1,2}\.){3}[0-2]?\d{1,2})/,ipv6:/^[0-9a-z\:\*\.]+$/,host_name:/([a-z0-9\-]+\.)+[a-z0-9\-]{2,63}$/i},skip:function(a){return{val:a}},trim:function(a){return{val:$.trim(a)}},minLength:function(b,a){if(b.length<a){return{val:false,error:"Must be at least "+a+" characters long"}}return{val:b}},maxLength:function(b,a){if(b.length>a){return{val:false,error:"Must be less than "+a+" characters long"}}return{val:b}},required:function(a){if($.trim(a)==""){return{val:false,error:this.validation_messages.required}}return{val:a}},validEmail:function(a){email=_.find(a.match(this.patterns.email),function(b){return b==a}),this;if(!email){return{val:false,error:this.validation_messages.validEmail}}return{val:email}},validDnsAnswer:function(a){return{val:a}},validUrl:function(a){if(a==""||a=="http://"){return{val:false,error:this.validation_messages.validUrl}}return{val:a}},validHost:function(a){host=a.match(this.patterns.host_name);if(!host){return{val:false,error:this.validation_messages.validHost}}return{val:a}},noSpecialChars:function(a){if(a.match(/[^a-zA-Z0-9]/)){return{val:false,error:this.validation_messages.noSpecialChars}}return{val:a}},numbersOnly:function(c,a){var b=c.replace(/\s+/g,"");if(!b.match(/^\d+$/)){return{val:false,error:"Invalid code"}}if(typeof a!="undefined"&&b.length!=a){return{val:false,error:"Invalid code length"}}return{val:c}},validTwitterUsername:function(b,a){if(!b.match(/^[a-zA-Z0-9_@]{1,15}$/)){return{val:false,error:"Only letters, numbers and '_' allowed"}}return{val:b}},validFacebookUsername:function(b,a){b=b.toLowerCase();if(b.indexOf("facebook.com")!=-1){return{val:false,error:"Do not include 'facebook.com' in username"}}if(!b.match(/^[a-zA-Z0-9.]{5,50}$/)){return{val:false,error:"Only letters, numbers and '.' allowed"}}return{val:b}},validFloat:function(b,a){if(b&&isNaN(b)){return{val:false,error:"Invalid number"}}return{val:b}},};RegistrarView=Backbone.View.extend({initialize:function(){this.registrar_initialize()},registrar_initialize:function(){if(typeof this.events=="undefined"){this.events={}}_.extend(this.events,this.ga_events)},track_ga:_.debounce(function(b){var c=$(b.target);if(!c.attr("data-ga")!="event"){c=c.closest('[data-ga="event"]')}var a=c.attr("data-ga-category");if(typeof a=="undefined"&&typeof this.gaCategory!="undefined"){a=this.gaCategory}_gaq.push(["_trackEvent",a,c.attr("data-ga-action"),c.attr("data-ga-label")])},30),ga_events:{'click [data-ga="event"]':"track_ga"},jEl:function(){return this.$el},validate_input:function(b,f,c,g,a){response=this.model.validateAttribute(b,f,a);data=[g,response];return this.update_validation(c,data)},update_validation:function(b,a){b="update_"+b+"_validation";return this[b].apply(this,a)},update_inline_validation:function(c,b){var a=c.closest(".control-group, .form-group");if(b.val===false){a.addClass("error has-error");if(!a.find(".help-inline").length){a.append('<div class="help-inline help-block"></div>')}a.find(".help-inline").html(b.error).show();return false}else{c.val(b.val);a.removeClass("error has-error");a.find(".help-inline").html("").hide();return true}},destroy_validation_popups:0,update_popup_validation:function(c,a){if(a.val===false){var b=this.popup_options?this.popup_options:{placement:"bottom",content:""+a.error,trigger:"manual"};c.popover(b);if(this.destroy_validation_popups){c.popover("destroy");c.popover(b)}c.popover("show");return false}else{c.popover("hide");return true}},enter_key_hit:function(a){return a.keyCode==13}});RegistrarModel=Backbone.Model.extend({validateAttribute:function(b,f,a){if(!RegistrarValidation.config[this.get("model_name")]||!RegistrarValidation.config[this.get("model_name")][b]){return{val:f}}var c;_.each(RegistrarValidation.config[this.get("model_name")][b],function(g,h){data=RegistrarValidation.config[this.get("model_name")][b][h]||[];data=new $.merge(Array(f),data);rtrn=RegistrarValidation.validate(h,data);if(!c||c.val!==false){c=rtrn;if(c.val!==false){f=c.val}}},this);if(a){this.set(b,f)}return c},destroy:function(a){a.data=JSON.stringify([{id:this.id}]);Backbone.Model.prototype.destroy.call(this,a)}});RegistrarCollection=Backbone.Collection.extend({save:function(b,a){a||(a={});b||(b="save");if(!a.url){a.url=this.url||urlError()}a.error=Backbone.wrapError(a.error,this,a);return Backbone.sync("update",this,a)},destroy:function(a){a=a?_.clone(a):{};var b=this;var g=a.success;var f=function(){b.trigger("destroy",b,b,a)};a.success=function(h){if(a.wait){f()}if(g){g(b,h)}else{b.trigger("sync",b,h,a)}};data=[];_.each(this.models,function(h){data.push({id:h.id})});a.data=JSON.stringify(data);a.error=Backbone.wrapError(a.error,b,a);var c=(this.sync||Backbone.sync).call(this,"delete",this,a);if(!a.wait){f()}return c},toJSON:function(){return this.models}});RegistrarPager=Backbone.Paginator.requestPager.extend({paginator_core:{type:"GET",dataType:"json"},paginator_ui:{firstPage:0,currentPage:0,perPage:50,totalPages:0,totalCount:0},server_api:{filters:{},limit:function(){return this.perPage},start:function(){return this.currentPage*this.perPage},order:"id",asc:0,format:"json"},parse:function(a){return a},fetchCount:function(b){if(!this.totalCount||b){this.server_api.get_count=1;var a=this;this.sync("get",this,{async:false}).success(function(c){a.totalCount=c.count});this.server_api.get_count=0}this.totalPages=Math.ceil(this.totalCount/this.perPage)},removeFilter:function(a,b){_.each(_.flatten([b]),function(c){this.server_api.filters[a]=_.reject(this.server_api.filters[a],function(f){return f==c})},this);if(!this.server_api.filters[a].length){delete this.server_api.filters[a]}this.pager()},addFilter:function(a,b){if(this.server_api.filters[a]){this.server_api.filters[a]=_.unique($.merge(this.server_api.filters[a],_.flatten([b])))}else{this.server_api.filters[a]=_.flatten([b])}this.currentPage=this.firstPage;this.pager()},sort:function(a,b){this.server_api.order=a;this.server_api.asc=b?1:0;this.pager()},save:function(b,a){a||(a={});b||(b="save");if(!a.url){a.url=this.url||urlError()}a.error=Backbone.wrapError(a.error,this,a);return Backbone.sync("update",this,a)},destroy:function(a){a=a?_.clone(a):{};var b=this;var g=a.success;var f=function(){b.trigger("destroy",b,b,a)};a.success=function(h){if(a.wait){f()}if(g){g(b,h)}else{b.trigger("sync",b,h,a)}};data=[];_.each(this.models,function(h){data.push({id:h.id})});a.data=JSON.stringify(data);a.error=Backbone.wrapError(a.error,b,a);var c=(this.sync||Backbone.sync).call(this,"delete",this,a);if(!a.wait){f()}return c},toJSON:function(){return this.models}});PaginatorView=Backbone.View.extend({el:$("#paginator"),template:_.template("<%currentPage++;firstPage++;%><div class='left pull-left largerightmargin smalltopmargin'>View&nbsp;<select class='smallinput perpage' name='perPage'><option value='20' <%= (perPage == 20?'selected':'')%> >20</option><option value='50' <%= (perPage == 50?'selected':'')%>>50</option><option value='100' <%= (perPage == 100?'selected':'')%>>100</option><option value='1000' <%= (perPage == 1000?'selected':'')%>>1000</option></select></div><div class='pagination notopmargin pull-left left'><ul class='pagination notopmargin pull-left left'><li class='<%= (currentPage == firstPage?'disabled':'prev') %>'><a>Prev</a></li><%if(totalPages <= 8){ for(var i=1;i<=totalPages;i++){%><li class='page <%= (currentPage == i?'active':'') %>'><a><%= i%></a></li><%}}else if(currentPage - firstPage <= 3){%><li class='page <%= (currentPage == 1?'active':'') %>'><a>1</a></li><li class='page <%= (currentPage == 2?'active':'') %>'><a>2</a></li><li class='page <%= (currentPage == 3?'active':'') %>'><a>3</a></li><li class='page <%= (currentPage == 4?'active':'') %>'><a>4</a></li><li class='page <%= (currentPage == 5?'active':'') %>'><a>5</a></li><li class='disabled'><a>...</a></li><li class='page'><a><%= lastPage %></a></li><%}else if(currentPage - firstPage >= 4 && currentPage <= lastPage -4 ){%><li class='page'><a><%= firstPage %></a></li><li class='disabled'><a>...</a></li><li class='page'><a><%= currentPage-1 %></a></li><li class='page active'><a><%= currentPage %></a></li><li class='page'><a><%= currentPage+1 %></a></li><li class='disabled'><a>...</a></li><li class='page'><a><%= lastPage %></a></li><%}else{%><li class='page'><a><%= firstPage %></a></li><li class='disabled'><a>...</a></li><li class='page <%= (currentPage == lastPage-4?'active':'') %>'><a><%= lastPage-4%></a></li><li class='page <%= (currentPage == lastPage-3?'active':'') %>'><a><%= lastPage-3%></a></li><li class='page <%= (currentPage == lastPage-2?'active':'') %>'><a><%= lastPage-2%></a></li><li class='page <%= (currentPage == lastPage-1?'active':'') %>'><a><%= lastPage-1%></a></li><li class='page <%= (currentPage == lastPage?'active':'') %>'><a><%= lastPage%></a></li><%}%><li class='<%= ((currentPage == lastPage || lastPage == 0)?'disabled':'next') %>'><a>Next</a></li></ul></div>"),render:function(a){this.collection.fetchCount();this.$el.html(this.template(this.collection.info()));this.post_render(a);return this},post_render:function(a){},events:{"click .page":"page","click .prev":"prev","click .next":"next","change .perpage":"perpage"},page:function(a){this.to_top=1;a.preventDefault();this.collection.goTo($(a.target).text()-1)},prev:function(a){this.to_top=1;a.preventDefault();this.collection.requestPreviousPage()},next:function(a){this.to_top=1;a.preventDefault();this.collection.requestNextPage()},perpage:function(a){this.to_top=1;a.preventDefault();this.collection.howManyPer($(a.target).find(":selected").val())}});Transfer=RegistrarModel.extend({urlRoot:"/api/v3/transfer",defaults:{model_name:"transfer"}});TransferCollection=RegistrarCollection.extend({model:Transfer,url:"/api/v3/transfer"});DomainModel=RegistrarModel.extend({urlRoot:"/api/v3/domain",defaults:{model_name:"domain"}});DomainCollection=RegistrarCollection.extend({model:DomainModel,url:"/api/v3/domain"});CartModel=RegistrarModel.extend({urlRoot:"/api/v3/cart",defaults:{model_name:"cart"}});CartCollection=RegistrarCollection.extend({model:CartModel,url:"/api/v3/cart"});phoneUtil=i18n.phonenumbers.PhoneNumberUtil.getInstance();function getFormattedPhone(a,j,f,g){format="";try{if(!a){return""}num_len=a.length;formatter=new i18n.phonenumbers.AsYouTypeFormatter(j);for(var c=0;c<num_len;++c){var b=a.charAt(c);format=formatter.inputDigit(b)}if(f!="format"&&g){if(f=="international"&&phoneUtil.isValidNumber(g)){format=phoneUtil.format(g,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL)}if(f=="national"&&(nat=phoneUtil.format(g,i18n.phonenumbers.PhoneNumberFormat.NATIONAL))){format=nat}}}catch(h){format=a}return format}function getPhoneNumber(a,c){c=c?c:"US";number=false;try{number=phoneUtil.parseAndKeepRawInput(a,c)}catch(b){}return number}function getPhoneCC(a){cc="";try{cc=phoneUtil.getRegionCodeForNumber(a)}catch(b){}if(cc){return cc.toUpperCase()}return false}RegistrarValidation.validPhone=function(b){try{if(!b){return{val:""}}cc=$(".tab-content .active-contact").find('select[name="fp-country"]').val();if(!cc){cc=$('select[name="new-contact-country"]').val()}number=phoneUtil.parseAndKeepRawInput(b,cc);if(phoneUtil.isValidNumber(number)){return{val:$.trim(b)}}}catch(a){}return{val:false,error:"Invalid Number"}};AccountContact=RegistrarModel.extend({defaults:{},defaults:{model_name:"contact",confirm_email_with_account_domain:false},nameMap:{first_name:"first_name",last_name:"last_name",organization:"company_name",address1:"address_1",address2:"address_2",phone:"phone",fax:"fax",email:"email",city:"city",state:"state",zip:"zip",country:"country",tax_id:"tax_id"}});AccountContacts=RegistrarCollection.extend({model:AccountContact,map:{0:"admin",1:"registrant",2:"billing",3:"tech"}});ContactView=RegistrarView.extend({tagName:"div",formatPhoneMap:{load:{valid:{"int":{cc_match:"national",no_cc_match:"international"},reg:{cc_match:"national",no_cc_match:"national"}},invalid:{"int":{cc_match:"national",no_cc_match:"format"},reg:{cc_match:"national",no_cc_match:"national"}}},change:{valid:{"int":{cc_match:"international",no_cc_match:"international"},reg:{cc_match:"national",no_cc_match:"national"}},invalid:{"int":{cc_match:"format",no_cc_match:"format"},reg:{cc_match:"national",no_cc_match:"national"}}},change_cc:{valid:{"int":{cc_match:"national",no_cc_match:"international"},reg:{cc_match:"national",no_cc_match:"international"}},invalid:{"int":{cc_match:"format",no_cc_match:"format"},reg:{cc_match:"national",no_cc_match:"format"}}}},load_data:{admin:{phone:{},fax:{}},registrant:{phone:{},fax:{}},billing:{phone:{},fax:{}},tech:{phone:{},fax:{}}},validation_set:{phone:false,fax:false},render:function(a){this.jEl().html(this.template(this.model.toJSON()));var c=this.model.get("country").toUpperCase();c=c?c:"US";if(typeof tax_countries[c]!="undefined"){this.jEl().find(".tax-row").removeClass("none")}else{this.jEl().find(".tax-row").addClass("none")}this.jEl().find('a[rel="tooltip"]').tooltip();var b=this.model.get("type");_.each(["phone","fax"],function(f){num=this.model.get(f);valid="invalid";if(number=getPhoneNumber(num,c)){valid=phoneUtil.isValidNumber(number)?"valid":"invalid"}if(!(this.load_data[b][f]["pcc"]=getPhoneCC(number))){this.load_data[b][f]["pcc"]=c}this.load_data[b][f]["int_num"]=phoneUtil.getCountryCodeForRegion(this.load_data[b][f]["pcc"]);match=(this.load_data[b][f]["pcc"]==c)?"cc_match":"no_cc_match";num_type="reg";if(num&&num.charAt(0)=="+"){num_type="int"}map=this.formatPhoneMap.load[valid][num_type][match];this.jEl().find('input[name="fp-'+f+'"]').val(getFormattedPhone(num,c,map,number))},this);return this},events:{"blur .phone":"change_phone",'change select[name="fp-country"]':"change_phone_cc","keyup .phone":"keyup_phone"},keyup_phone:function(b){var c=this.jEl().find('select[name="fp-country"]').val();c=c?c:"US";var a=$(b.target).val();valid="invalid";if(a&&(number=getPhoneNumber(a,c))){valid=phoneUtil.isValidNumber(number)?"valid":"invalid"}type=$(b.target).attr("name").replace("fp-","");if(this.validation_set[type]&&valid=="valid"){this.validate_input(type,$(b.target).val(),"inline",$(b.target),true);this.change_phone(b)}},change_phone:function(c){var f=this.jEl().find('select[name="fp-country"]').val();f=f?f:"US";var a=$(c.target).val();var b="invalid";if(a&&(number=getPhoneNumber(a,f))){b=phoneUtil.isValidNumber(number)?"valid":"invalid"}if(!(pcc=getPhoneCC(number))){pcc=f}match=(pcc==f)?"cc_match":"no_cc_match";num_type="reg";if(a&&a.charAt(0)=="+"){num_type="int"}map=this.formatPhoneMap.change[b][num_type][match];$(c.target).val(getFormattedPhone(a,f,map,number))},change_phone_cc:function(a){var b=$(a.target).val();b=b?b:"US";role=this.model.get("type");_.each(["phone","fax"],function(c){num=this.jEl().find('input[name="fp-'+c+'"]').val();match=(this.load_data[role][c]["pcc"]==b)?"cc_match":"no_cc_match";num_type="reg";if(num&&num.charAt(0)=="+"){num_type="int"}if(num&&num_type=="reg"&&this.load_data[role][c]["int_num"]){num="+"+this.load_data[role][c]["int_num"]+"."+num}valid="invalid";if(number=getPhoneNumber(num,b)){valid=phoneUtil.isValidNumber(number)?"valid":"invalid"}map=this.formatPhoneMap.change_cc[valid][num_type][match];this.jEl().find('input[name="fp-'+c+'"]').val(getFormattedPhone(num,b,map,number))},this)},update:function(a){el=$(this.el);el.find(".update").hide();el.find(".wait").show();$(".alert-success").hide();$(".alert-error").hide();save=true;ccc=$(this.el).find('select[name="fp-country"]').val();ccc=ccc?ccc:"US";a={};a.target=el.find('input[name="fp-phone"]');this.change_phone(a);a.target=el.find('input[name="fp-fax"]');this.change_phone(a);_.each(el.find(".validate"),function(b){name=this.model.nameMap[$(b).attr("name").replace("fp-","")];if(!this.validate_input(name,$(b).val(),"inline",$(b),true)){save=false;if(name=="phone"||name=="fax"){this.validation_set[name]=true}}},this);if(save){if(number=getPhoneNumber(this.model.get("phone"),ccc)){this.model.set("phone",phoneUtil.format(number,i18n.phonenumbers.PhoneNumberFormat.E164))}if(number=getPhoneNumber(this.model.get("fax"),ccc)){this.model.set("fax",phoneUtil.format(number,i18n.phonenumbers.PhoneNumberFormat.E164))}return true}else{StickyAlerts.alert({type:"error",heading:"ERROR:",message:"There are one or more errors in your contacts. Please correct them and try again."})}return save}});ContactsView=RegistrarView.extend({el:$("#contacts"),initialize:function(){this.collection.bind("sync",this.render,this);this.collection.bind("reset",this.render,this)},render:function(a){this.cvs={};_.each(this.collection.models,function(g,b){var f=this.collection.map[b];g.set("type",f);this.cvs[f]=new ContactView({model:g});$(this.cvs[f].el).addClass("contact-type").attr("id",f);$("#"+f+"-tab").html(this.cvs[f].render().el)},this)},enter_key:function(a){if(this.enter_key_hit(a)){this.update(a)}},confirm_account_email:function(a){this.jEl().find("#account_domain_modal").modal("hide");_.each(this.collection.models,function(b){b.set("confirm_email_with_account_domain",true)});this.update(a)},update:function(b){role=$(b.target).closest(".contact-type").attr("id");if(this.cvs[role].update()){el=$(this.cvs[role].el);if(el.find(".update-all").prop("checked")){newcontacts=new AccountContacts();_.each(this.collection.models,function(g,f){cu=this.cvs[role].model.clone();_.each(this.cvs[role].model.attributes,function(h,c){cu.attributes[c]=$.trim(h)});cu.set("type",this.collection.map[f]);newcontacts.add(cu)},this);this.collection=newcontacts}var a=this.collection.save({},{error:_.bind(function(f,c){this.error(f,c)},this),success:_.bind(function(f,c){this.success(f,c)},this),});if(el.find(".update-all").prop("checked")&&!this.single_contact_type){this.render()}}el.find(".wait").hide();el.find(".update").show()},success:function(b,a){StickyAlerts.alert({type:"success",heading:"",message:"Contact(s) successfully updated."});this.jEl().find(".alert-success").show();this.jEl().find(".alert-error").hide();this.post_update()},post_update:function(){},error:function(h,f){if(r=JSON.parse(f.responseText)){if(r.irtp_required||r.verification_required){var c=this.collection.at(1);verifyContact(JSON.stringify(c.attributes),this.jEl().find('#registrant input[type="submit"]')[0],r.verification_required,r.irtp_required,this)}else{if(r.errors){var g=[];for(id in r.errors){var b=this.collection.map[id];if(_.indexOf(g,b)==-1){g.push(b)}for(attr in r.errors[id]){f={val:false,error:r.errors[id][attr]};target=$("#"+b+' [name="fp-'+attr+'"]');this.update_inline_validation(target,f)}}var i="";_.each(g,function(a,j){if(!this.single_contact_type||this.single_contact_type==a){if(j==0||!i){i+=a}else{if(j==g.length-1){i+=" and "+a}else{i+=", "+a}}}},this);StickyAlerts.alert({type:"error",heading:"ERROR:",message:"The "+i+" contact"+((g.length>1)?"s have":" has")+" errors. Please correct them and try again."})}else{if(r.error){if(r.error.indexOf("Email Associated With Account Domain")!=-1){this.jEl().find(".active-contact #account_domain_modal").modal("show")}else{StickyAlerts.alert({type:"error",heading:"ERROR:",message:r.error})}}}}}}});Nameserver=RegistrarModel.extend({validate:function(a){a.hostname=maskNameserver($.trim(a.hostname));if(a.hostname==""){return"Hostame cannot be empty."}if(!a.hostname.match(/([a-z0-9\-]+\.)+[a-z]{2,63}$/i)){return"The nameserver you entered ("+(a.hostname.replace(/[^0-9a-z.-]/g,""))+") does not appear to be valid."}count=0;_.each(app.nameserverCollection.models,function(b){if(b.get("id")!=this.id&&maskNameserver(b.get("hostname").toLowerCase())==maskNameserver(a.hostname.toLowerCase())){count++}},this);if(count>0){return"Duplicate nameservers aren't allowed."}}});NameserverView=RegistrarView.extend({tagName:"div",className:"nameserverrow",template:function(a){if($("#nameserver-item").length){return _.template($("#nameserver-item").html())(a)}return false},initialize:function(){this.model.bind("change",this.render,this)},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this},mark_for_delete:function(){if(this.model.get("view_only")){return}app.nameserverCollection.remove(this.model);this.nameserverControlView.apply_needed()},edit:function(){if(this.model.get("view_only")){return}this.jEl().find(".editing").show().addClass("opened");this.jEl().find("span.hostname").hide();this.jEl().find(".nsedit").hide();this.jEl().find(".nsdelete").hide();$("#applyChanges").addClass("disabled")},keyup_check:function(a){if(this.enter_key_hit(a)){this.update_ns(a)}},update_ns:function(b){var a=this.jEl().find("input");if(this.model.set({hostname:a.val()},{error:function(c,f){this.nameserverControlView.display_error(f)}})){this.jEl().find(".editing").hide().removeClass("opened");this.jEl().find("span.hostname").show();this.jEl().find(".nsedit").show();this.jEl().find(".nsdelete").show();if(!$("#nameservers .opened").html()){$("#applyChanges").removeClass("disabled")}this.nameserverControlView.hide_error().apply_needed()}else{a.parent().addClass("error")}},cancel:function(a){val=this.jEl().find("span.hostname").show().text();this.jEl().find(".editing").hide().removeClass("opened").find('input[name="hostname"]').val(val);this.jEl().find(".nsedit").show();this.jEl().find(".nsdelete").show();if(!$("#nameservers .opened").html()){$("#applyChanges").removeClass("disabled")}},events:{"click .nsdelete":"mark_for_delete","click span.hostname":"edit","click .nsedit":"edit","keyup input":"keyup_check","click .update":"update_ns","click .cancel":"cancel"}});NameserverControlView=Backbone.View.extend({el:$("#nameserverControl"),template:function(a){if($("#nameserver-item").length){return _.template($("#nameserver-item").html())(a)}return false},apply_changes:function(b,a){if(a==undefined){a={}}if(a.success==undefined){a.success=_.bind(function(f,c){this.success(c)},this)}if(a.error==undefined){a.error=_.bind(function(f,c){this.error(c)},this)}if(!$(b.target).hasClass("disabled")){this.collection.save(null,a);$(".apply").hide();$(".wait").show()}},cancel_changes:function(){this.collection.fetch();this.apply_not_needed()},apply_needed:function(){$("#applySection").removeClass("none");$("#applyChanges").removeClass("disabled")},if_apply_needed:function(){if($("#applySection").length==0){return false}return !$("#applySection").hasClass("none")},apply_not_needed:function(){$("#applySection").addClass("none")},add_if_enter:function(a){if(a.keyCode==13){this.add_nameserver()}},add_nameserver:function(){var g=$("#newHostname");var f=g.val();if(app.nameserverCollection.length>12){this.display_error("The max number of nameservers is 13.");return}try{var a="n"+Math.floor((Math.random()*100000)+1)+"-"+(new Date().getTime());var b=this;this.collection.add([{hostname:f,id:a}],{error:function(i,h){b.display_error(h)}});g.val("").parent().removeClass("error");this.hide_error().apply_needed()}catch(c){g.parent().addClass("error")}},use_template:function(a){name=$(a.target).attr("name");var b=[];for(ii in this.ns_templates[name]){b.push({hostname:this.ns_templates[name][ii]})}this.collection.reset(b);this.apply_needed()},delete_all:function(){var a=[];$("#nsalertMessage").html('Your nameservers have removed.<br>You must "Apply Changes" for the changes to take effect.').parent().removeClass("none").delay(5000).fadeOut(1000,function(){$(this).addClass("none").css("display","")});this.collection.reset(a);this.apply_needed()},display_error:function(a){$(".apply").show();$(".wait").hide();if(a==undefined){a="Unknown Error. Nameservers may not exist."}$("#nserrorMessage").html("<strong>An error occurred:</strong><br>"+a).parent().removeClass("none");return this},error:function(a){var b="An error occured.";if(r=JSON.parse(a.responseText)){b=r.error}return this.display_error(b)},success:function(a){return this.display_success()},display_success:function(){$(".apply").show();$(".wait").hide();$("#nssuccessMessage").html("Update applied successfully").parent().removeClass("none").delay(5000).fadeOut(1000,function(){$(this).addClass("none").css("display","")});this.apply_not_needed();return this},hide_error:function(){$("#nserrorMessage").parent().addClass("none");return this},events:{"click #applyChanges":"apply_changes","click #cancelChanges":"cancel_changes","click #addNameserver":"add_nameserver","click .template":"use_template","click #deleteAll":"delete_all","keypress #newHostname":"add_if_enter"}});NameserversView=RegistrarView.extend({el:$("#nameservers"),initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this);this.collection.bind("remove",this.render,this);this.collection.bind("add",this.render,this)},render:function(a){this.jEl().html("");if(!this.nameserverControlView){this.nameserverControlView=new NameserverControlView({collection:this.collection})}this.nameserverControlView.render();_.each(this.collection.models,function(b){ns=new NameserverView({model:b});$(this.el).append(ns.render().el);ns.nameserverControlView=this.nameserverControlView},this);return this}});UrlfRow=RegistrarView.extend({tagName:"div",className:"urlfrow borderbottomgray padding9",template:function(a){if($("#urlf-row").length){return _.template($("#urlf-row").html())(a)}return false},initialize:function(){this.model.bind("change",this.render,this)},render:function(a){$(this.el).html(this.template(this.model.toJSON()));return this},events:{"click .edit":"edit","click .cancel":"cancel","click .delete":"delete_urlf","click .confirm-delete":"confirm_delete","click .update":"update","keyup .validate":"enter_key","change .redirecttype":"update_form_field"},enter_key:function(a){if(this.enter_key_hit(a)){$(this.el).find(".btn").click()}},update_form_field:function(a){if(this.jEl().find(".redirecttype").val()=="1"){this.jEl().find(".showextras").show()}else{this.jEl().find(".showextras").hide();this.jEl().find('[name="title"]').val("");this.jEl().find('[name="meta"]').val("")}},edit:function(a){this.template=_.template($("#edit-urlf-row").html());return this.render()},cancel:function(a){this.template=_.template($("#urlf-row").html());$(".popover").hide();return this.render()},update:function(c){$(".popover").remove();var b=true;var a={};_.each($(c.target).closest("div.urlfrow").find(".validate"),function(f){if(b){if(this.validate_input($(f).attr("name"),$(f).val(),"popup",$(f),false)){a[$(f).attr("name")]=$(f).val()}else{b=false}}},this);if(b){_.each(a,function(g,f){this.model.set(f,g)},this);this.cancel();this.model.save({},{error:_.bind(function(g,f){this.error(g,f)},this)})}return this},error:function(b,a){if(r=JSON.parse(a.responseText)){this.template=_.template($("#edit-urlf-row").html());this.render();if(r.errors){for(id in r.errors){for(attr in r.errors[id]){a={val:false,error:r.errors[id][attr]};target=$(this.el).find('[name="'+attr+'"]');this.update_popup_validation(target,a);b.fetch();return}}}else{if(r.error){a={val:false,error:r.error};target=$(this.el);this.update_popup_validation(target,a);b.fetch();return}}}},confirm_delete:function(a){this.model.destroy({error:_.bind(function(c,b){this.delete_error(c,b)},this)});$(this.el).remove()},delete_error:function(b,a){alert("An unexpected error occurred.  Please refresh the page and try again");refresh()},delete_urlf:function(a){$(this.el).find(".action").html(_.template($("#delete-urlf-action").html()))}});UrlfView=RegistrarView.extend({el:$("#urlf"),initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(a){$(this.el).find("div").html("");this._rowPointers=[];_.each(this.collection.models,function(b){tr=new UrlfRow({model:b});this._rowPointers[b.cid]=tr;$(this.el).find("div.urlftable").append(tr.render().el)},this);$(this.el).find("div.urlftable").append(_.template($("#urlf-add-row").html())({type:"A",prio:"",ttl:"",name:"",content:""}));$("#urlftt").tooltip({container:"body",placement:"auto",html:"true"});$("#metatt").tooltip({container:"body",placement:"auto",delay:{hide:2000}});return this},events:{"click .add-urlf":"add_urlf","change .add-urlfs .redirecttype":"update_form_field"},update_form_field:function(a){if(this.jEl().find(".add-urlfs .redirecttype").val()=="1"){this.jEl().find(".add-urlfs .showextras").show()}else{this.jEl().find(".add-urlfs .showextras").hide();this.jEl().find('.add-urlfs [name="title"]').val("");this.jEl().find('.add-urlfs [name="meta"]').val("")}},add_urlf:function(a){$(".popover").remove();save=true;this.model=new UrlfModel();_.each($(a.target).closest("div.add-urlfs").find(".validate"),function(c){if(save){if(!this.validate_input($(c).attr("name"),$(c).val(),"popup",$(c),true)){save=false}}},this);if(save){$(".popover").remove();r=this.model.save({},{error:_.bind(function(f,c){this.add_error(f,c)},this),async:false});if(r.status==200){var b=new Date();this.model.set("create_date",b.toISOString());this.collection.add(this.model);tr=new UrlfRow({model:this.model});this._rowPointers[this.model.cid]=tr;this.add_urlf_render(tr)}}},add_urlf_render:function(a){$(".add-urlfs").remove();$(this.el).find("div.urlftable").append(a.render().el);$(this.el).find("div.urlftable").append(_.template($("#urlf-add-row").html()))},add_error:function(b,a){if(r=JSON.parse(a.responseText)){this.collection.remove(b);this.render();if(r.errors){for(attr in r.errors[0]){a={val:false,error:r.errors[0][attr]};target=$('.add-error  [name="'+attr+'"]');this.update_popup_validation(target,a);return}}else{if(r.error){a={val:false,error:r.error};target=$(".add-urlf");StickyAlerts.alert({type:"error",heading:"Error!",message:a.error});return}}}}});DnsRow=RegistrarView.extend({tagName:"tr",template:function(a){if($("#dns-row").length){return _.template($("#dns-row").html())(a)}return false},render:function(a){checked=$(this.el).find(":checkbox").prop("checked");$(this.el).html(this.template(this.model.toJSON()));$(this.el).find(":checkbox").prop("checked",checked);return this},events:{"click .edit":"edit","click .update":"update","click .delete":"delete_record","click .cancel":"cancel","click .confirm-delete":"confirm_delete","keyup .validate":"enter_key"},enter_key:function(a){if(this.enter_key_hit(a)){$(this.el).find(".btn").click()}},confirm_delete:function(a){this.model.destroy({error:_.bind(function(c,b){this.delete_error(c,b)},this)});$(this.el).remove()},delete_error:function(b,a){alert("An unexpected error occurred.  Please refresh the page and try again");refresh()},delete_record:function(a){$(this.el).find(".action").html(_.template($("#delete-dns-action").html()))},edit:function(a){this.template=_.template($("#edit-dns-row").html());return this.render()},update:function(a){$(".popover").remove();save=true;_.each($(a.target).closest("tr").find(".validate"),function(b){if(save){if(!this.validate_input($(b).attr("name"),$(b).val(),"popup",$(b),true)){save=false}}},this);if(save){name=this.model.get("name");this.model.set("name",(name?(name+"."+window.domain_name):window.domain_name));this.cancel();this.model.save({},{error:_.bind(function(c,b){this.error(c,b)},this)})}return this},cancel:function(a){this.template=_.template($("#dns-row").html());$(".popover").hide();return this.render()},error:function(b,a){if(r=JSON.parse(a.responseText)){this.template=_.template($("#edit-dns-row").html());this.render();if(r.errors){for(id in r.errors){for(attr in r.errors[id]){a={val:false,error:r.errors[id][attr]};if(attr=="host"){attr="name"}target=$(this.el).find('[name="'+attr+'"]');this.update_popup_validation(target,a);b.fetch();return}}}else{if(r.error){a={val:false,error:r.error};target=$(this.el);this.update_popup_validation(target,a);b.fetch();return}}}}});DnsView=RegistrarView.extend({el:$("#dns"),initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(b){$(this.el).find("tbody.main-table").html("");this._rowPointers=[];this.collection.models=_.sortBy(this.collection.models,function(h){return h.get("id")});var c=false;var a=false;var g={};var f={};_.each(this.collection.models,function(h){dns_type=h.get("type").toUpperCase();if(!((dns_type=="NS"||dns_type=="SOA")&&h.get("name").toLowerCase()==window.domain_name.toLowerCase())){tr=new DnsRow({model:h});if(0&&h.get("type")=="CNAME"&&h.get("name").toLowerCase()==window.domain_name){c=1;$(tr.el).addClass("error")}if(h.get("type")=="CNAME"){g[h.get("name").toLowerCase()]=h.get("name").toLowerCase()}if(!f[h.get("name").toLowerCase()]){f[h.get("name").toLowerCase()]={}}f[h.get("name").toLowerCase()][h.cid]=h.cid;this._rowPointers[h.cid]=tr;$(this.el).find("tbody.main-table").append(tr.render().el)}},this);_.each(g,function(h){if(_.size(f[h])>1){_.each(f[h],function(i){if(!$(this._rowPointers[i].el).hasClass("error")){$(this._rowPointers[i].el).addClass("warning")}},this);a=true}},this);if(a){$("#dns-tab-content h2").after('<p class="colororange regularfont">You currently have a CNAME record that conflicts with other DNS records on the same host. We highly recommend that you remove the conflicting record and reconfigure your DNS. This record cannot be reinstated once it is removed.</p>')}if(c){$("#dns-tab-content h2").after('<p class="colorred regularfont">You currently have a CNAME record on the root of your domain. We highly recommend that you remove this record and reconfigure your DNS. This record cannot be reinstated once it is removed.</p>')}$(this.el).find("tbody.main-table").append(_.template($("#dns-add-row").html())({type:"A",prio:"10",ttl:"",name:"",content:""}));return this},events:{"click .add-record":"add_record","click .bulk-action":"bulk_action","click .bulk-confirm":"bulk_confirm","click #select_all":"select_all","click .bulk-close":"bulk_close","keyup .validate":"enter_key","click input[type='checkbox']":"update_bulk","click .bulk-update":"update_bulk"},enter_key:function(a){if(this.enter_key_hit(a)){$(a.target).closest("tr").find(".btn").click()}},update_bulk:function(a){if(this.is_bulk_loaded){this.load_bulk($(this.el).find("button.bulk-action").attr("name"))}},bulk_close:function(a){this.is_bulk_loaded=false;$("#bulk-action-row").html("")},select_all:function(a){$("input:checkbox[name='record_id']").prop("checked",$(a.target).prop("checked"))},add_record:function(f){$(".popover").remove();save=true;this.model=new DnsModel();this.model.set("prio",null);_.each($(f.target).closest("tr").find(".validate"),function(i){if(save){if(!this.validate_input($(i).attr("name"),$(i).val(),"popup",$(i),true)){save=false}}},this);if(this.model.get("type")=="SRV"){var b=$(f.target).closest("tr");var h=$.trim(b.find('input[name="srv_weight"]').val());if(h==""){this.update_popup_validation(b.find('input[name="srv_weight"]'),{val:false,error:"Weight Required"})}var c=$.trim(b.find('input[name="srv_port"]').val());if(c==""){this.update_popup_validation(b.find('input[name="srv_port"]'),{val:false,error:"Port Required"})}var a=$.trim(b.find('input[name="srv_protocol"]').val());if(a==""){this.update_popup_validation(b.find('input[name="srv_protocol"]'),{val:false,error:"Protocol Required"})}else{if(a.charAt(0)!="_"){a="_"+a}}var g=this.model.get("name");if(g.charAt(0)!="_"){g="_"+g}this.model.set("content",h+" "+c+" "+this.model.get("content"));this.model.set("name",g+"."+a)}if(save){name=this.model.get("name");this.model.set("name",(name?(name+"."+window.domain_name):window.domain_name));this.model.set("create_date",JSON.stringify(new Date()));$(".popover").remove();r=this.model.save({},{error:_.bind(function(j,i){this.add_error(j,i)},this),async:false});if(r.status==200){this.collection.add(this.model);b=new DnsRow({model:this.model});this._rowPointers[this.model.cid]=b;$("#add-records").remove();$(this.el).find("tbody.main-table").append(b.render().el);$(this.el).find("tbody.main-table").append(_.template($("#dns-add-row").html())({type:"A",prio:"10",ttl:"",name:"",content:""}))}}},add_error:function(b,a){if(r=JSON.parse(a.responseText)){$("#add-records").remove();$(this.el).find("tbody.main-table").append(_.template($("#dns-add-row").html())(this.model.toJSON()));if(r.errors){for(attr in r.errors[0]){a={val:false,error:r.errors[0][attr]};if(attr=="host"){attr="name"}target=$('#add-records  [name="'+attr+'"]');this.update_popup_validation(target,a);return}}else{if(r.error){a={val:false,error:r.error};target=$("#add-records");this.update_popup_validation(target,a);return}}}},bulk_confirm:function(a){var b=$(".bulk-action").filter(":visible").attr("name");if(b=="template_show"){this.DnsTemplateView.bulk_confirm();this.collection.fetch();this.bulk_close()}else{if(b=="delete"){this.BulkCollection.destroy({async:false});this.collection.fetch();this.bulk_close()}}},bulk_action:function(a){this.is_bulk_loaded=true;this.load_bulk($(a.target).attr("name"))},load_bulk:function(b){if(b=="template_show"){if(!this.DnsTemplateCollection){this.DnsTemplateCollection=new DnsTemplateCollection()}if(!this.DnsTemplateView){this.DnsTemplateView=new DnsTemplateView({collection:this.DnsTemplateCollection})}this.DnsTemplateCollection.fetch()}else{var a=0;this.BulkCollection=new DnsCollection();_.each(this.collection.models,function(c){if((tr=this._rowPointers[c.cid])&&$(tr.el).find("input:checkbox").prop("checked")){a++;this.BulkCollection.add(c)}},this);this.BulkEditView=new BulkEditView({collection:this.BulkCollection});this.BulkEditView.options={action:b,action_display:$(this.el).find("button.bulk-action").html(),total:a};this.BulkEditView.render()}}});EmailforwardingRow=RegistrarView.extend({tagName:"tr",className:"emailrow",template:function(a){if($("#emailforwarding-row").length){return _.template($("#emailforwarding-row").html())(a)}return false},render:function(a){checked=$(this.el).find(":checkbox").prop("checked");$(this.el).html(this.template(this.model.toJSON()));$(this.el).find(":checkbox").prop("checked",checked);return this},events:{"click .edit":"edit","click .update":"update","click .delete":"delete_record","click .cancel":"cancel","click .confirm-delete":"confirm_delete","keyup .validate":"enter_key"},enter_key:function(a){if(this.enter_key_hit(a)){$(this.el).find(".btn").click()}},confirm_delete:function(a){this.model.destroy({error:_.bind(function(c,b){this.delete_error(c,b)},this)});$(this.el).remove()},delete_error:function(b,a){alert("An unexpected error occurred.  Please refresh the page and try again");refresh()},delete_record:function(a){$(this.el).find(".action").html(_.template($("#delete-emailforwarding-action").html()))},edit:function(a){this.template=_.template($("#edit-emailforwarding-row").html());return this.render()},update:function(a){$(".popover").remove();save=true;_.each($(a.target).closest(".emailrow").find(".validate"),function(b){if(save){if(!this.validate_input($(b).attr("name"),$(b).val(),"popup",$(b),true)){save=false}}},this);if(save){name=this.model.get("name");this.model.set("name",(name?(name+"."+window.domain_name):window.domain_name));this.model.save({},{error:_.bind(function(c,b){this.error(c,b)},this),success:_.bind(function(c,b){this.cancel()},this)})}return this},cancel:function(a){this.template=_.template($("#emailforwarding-row").html());$(".popover").hide();return this.render()},error:function(b,a){if(r=JSON.parse(a.responseText)){if(r.errors){for(id in r.errors){for(attr in r.errors[id]){a={val:false,error:r.errors[id][attr]};if(attr=="host"){attr="name"}target=$(this.el).find('[name="'+attr+'"]');this.update_popup_validation(target,a);b.fetch();return}}}else{if(r.error){a={val:false,error:r.error};target=$(this.el);this.update_popup_validation(target,a);b.fetch();return}}}}});EmailforwardingView=RegistrarView.extend({el:$("#emailforwarding"),destroy_validation_popups:1,initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(a){$(this.el).find("tbody.main-table").html("");this._rowPointers=[];this.collection.models=_.sortBy(this.collection.models,function(b){return b.get("id")});_.each(this.collection.models,function(b){tr=new EmailforwardingRow({model:b});this._rowPointers[b.cid]=tr;$(this.el).find("tbody.main-table").prepend(tr.render().el)},this);$(this.el).find("tbody.main-table").prepend(_.template($("#emailforwarding-add-row").html())({email:"","goto":""}));return this},events:{"click .add-record":"add_record","keyup .validate":"enter_key"},enter_key:function(a){if(this.enter_key_hit(a)){$(a.target).closest("tr").find(".btn").click()}},select_all:function(a){$("input:checkbox[name='record_id']").prop("checked",$(a.target).prop("checked"))},add_record:function(a){$(".popover").remove();save=true;this.model=new EmailforwardingModel();_.each($(a.target).closest("#add-records").find(".validate"),function(b){if(save){if(!this.validate_input($(b).attr("name"),$(b).val(),"popup",$(b),true)){save=false}}},this);if(save){name=this.model.get("email");this.model.set("create_date",JSON.stringify(new Date()));$(".popover").remove();r=this.model.save({},{error:_.bind(function(c,b){this.add_error(c,b)},this),async:false});if(r.status==200){this.collection.add(this.model);tr=new EmailforwardingRow({model:this.model});this._rowPointers[this.model.cid]=tr;this.add_record_render(tr)}}},add_record_render:function(b){this.jEl().find("#add-records").remove();var a=this.jEl().find("tbody.main-table");a.prepend(b.render().el);a.prepend(_.template($("#emailforwarding-add-row").html())({email:"","goto":""}))},add_error:function(b,a){if(r=JSON.parse(a.responseText)){if(r.errors){for(attr in r.errors[0]){a={val:false,error:r.errors[0][attr]};target=$('#add-records  [name="'+attr+'"]');this.update_popup_validation(target,a);return}}else{if(r.error){a={val:false,error:r.error};target=$("#add-records");this.update_popup_validation(target,a);return}}}}});EmailboxRow=RegistrarView.extend({tagName:"div",template:function(a){if($("#emailbox-row").length){return _.template($("#emailbox-row").html())(a)}return false},render:function(a){$(this.el).html(this.template(this.model.toJSON()));return this}});EmailboxView=RegistrarView.extend({el:$("#emailboxes"),initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(a){if(this.collection.length>0){$("#manage_email_link a").html("Manage Email Accounts")}else{$("#manage_email_link a").html("");$("#emailboxes").addClass("none");$("#noemailboxes").removeClass("none")}$(this.el).find("div.main-table").html("");this._rowPointers=[];this.collection.models=_.sortBy(this.collection.models,function(b){return b.get("id")});_.each(this.collection.models,function(b){tr=new EmailboxRow({model:b});this._rowPointers[b.cid]=tr;$(this.el).find("div.main-table").prepend(tr.render().el)},this);return this}});NsregistrationRow=RegistrarView.extend({tagName:"div",className:"col-sm-12 padding12 borderlightgray row_parent",b_refreshed:false,events:{"click .edit":"pre_edit_sync_individual_host","click .update":"update","click .delete":"delete_record","click .cancel":"cancel","click .cancel_remove_ip":"cancel_remove_ip","click .confirm-delete":"confirm_delete","click .add_ip":"pre_add_ip","click .remove_ip":"confirm_remove_ip","click .confirm_remove_ip":"pre_remove_ip","keyup .validate":"enter_key"},enter_key:function(a){if(this.enter_key_hit(a)){$(this.el).find(".btn").click()}},template:function(a){if($("#nsregistration-row").length){return _.template($("#nsregistration-row").html())(a)}return false},render:function(a){$(this.el).html(this.template(this.model.toJSON()));return this},pre_edit_sync_individual_host:function(c){var b=this;var a=$(c.target).closest(".row_parent").find(".row_hostname").html();if(!this.b_refreshed){$.post("/ajax/domain_management/sync_domain/"+window.domain_name+"/"+a,{async:false,action:"sync_host"},{},"json").done(function(g,h,f){b.b_refreshed=true;b.model.set("ips",g.ips);b.template=_.template($("#nsregistration-row").html());$(".popover").hide();b.render();b.edit(c)})}else{this.edit(c)}},edit:function(a){this.template=_.template($("#edit-nsregistration-row").html());return this.render()},delete_record:function(a){$(this.el).find(".action").html(_.template($("#delete-nsregistration-action").html()))},confirm_delete:function(a){this.model.destroy({error:_.bind(function(c,b){this.delete_error(c,b)},this)});$(this.el).remove()},delete_error:function(b,a){alert("An unexpected error occurred.  Please refresh the page and try again");refresh()},pre_add_ip:function(a){this.model.set("action","add_ip");this.update(a)},pre_remove_ip:function(a){this.model.set("action","remove_ip");var b=$(a.target).closest("div").find(".span_remove_ip").html();this.model.set("ip",b);this.update(a)},confirm_remove_ip:function(a){$(this.el).find(".action").html(_.template($("#delete-ip-action").html()))},cancel_remove_ip:function(a){$(".popover").remove();$(this.el).find(".action").html(_.template($("#cancel_remove_ip").html()))},update:function(f){$(".popover").remove();var c=this.model.get("action");var b=this.model.get("hostname");save=true;if(c=="add_ip"){_.each($(f.target).closest("div").find(".validate"),function(h){if(save){if(!this.validate_input($(h).attr("name"),$(h).val(),"popup",$(h),true)){save=false}}},this)}else{if(c=="remove_ip"){if(!this.validate_input("ip",this.model.get("ip"),"popup",$(this.el),true)){save=false}}}if(save){this.model.save({},{success:_.bind(function(i,h){this.save_success(i,h)},this),error:_.bind(function(i,h){this.error(i,h)},this),async:false});if(window.has_dns){var a=(c=="add_ip")?"add_host_ip_dns":"remove_host_ip_dns";var g={async:false,action:a,ip:this.model.get("ip")};$.post("/ajax/domain_management/sync_domain/"+window.domain_name+"/"+b,g,{},"json").done(function(i,j,h){})}}return this},save_success:function(c,b){var g=this.model.get("ips");var f=this.model.get("action");if(f=="remove_ip"){var a=this.model.get("ip");var h=-1;$.each(g,function(i,j){if(j.ip==a){h=i}});if(h!=-1){this.model.set(g.splice(h,1))}}else{if(f=="add_ip"){g.push({ip:this.model.get("ip"),host_id:this.model.get("id")});this.model.set("ips",g)}}this.cancel()},error_sticky:function(b,a){if(r=JSON.parse(a.responseText)){this.template=_.template($("#edit-nsregistration-row").html());this.render();var c="An error occurred while processing your request.";if(r.error){c=r.error;b.fetch()}StickyAlerts.alert({type:"danger",heading:"",message:c})}},error:function(b,a){$(".popover").remove();if(r=JSON.parse(a.responseText)){if(r.errors){for(attr in r.errors[0]){a={val:false,error:r.errors[0][attr]};target=$('#edit-nsregistration-row [name="ip"]');this.update_popup_validation(target,a);return}}else{if(r.error){a={val:false,error:r.error};target=$("#anchor_popover");this.update_popup_validation(target,a);return}}}},cancel:function(a){this.template=_.template($("#nsregistration-row").html());$(this.el).find("tbody.main-table").append(_.template($("#nsregistration-add-row").html())({}));$(".popover").hide();return this.render()}});NsregistrationView=RegistrarView.extend({el:$("#nsregistration"),initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},events:{"click .add-record":"add_record","click .sync-domain":"sync_domain","click .sync_host_list":"sync_host_list"},render:function(a){if(supports_host_create&&window.tld!="im"){$(this.el).find("div.main-table").html("");this._rowPointers=[];this.collection.models=_.sortBy(this.collection.models,function(b){return b.get("id")});_.each(this.collection.models,function(b){tr=new NsregistrationRow({model:b});this._rowPointers[b.cid]=tr;$(this.el).find("div.main-table").prepend(tr.render().el)},this);if($("#nsregistration-add-row").length){$(this.el).find("div.main-table").append(_.template($("#nsregistration-add-row").html())({}))}}else{$("#nsregistration").addClass("none");$("#nonsregistration").removeClass("none")}return this},sync_host_list:function(){var a=this;$.post("/ajax/domain_management/sync_domain/"+window.domain_name,{async:false,action:"sync_host_list"},{},"json").done(function(b,f,c){return true})},sync_domain:function(b){var a=this;$.post("/ajax/domain_management/sync_domain/"+window.domain_name,{async:false,action:"sync_domain"},function(c){if(c){}},"json").done(function(c,g,f){refresh();return false})},add_record:function(a){$(".popover").remove();save=true;this.model=new NsregistrationModel();_.each($(a.target).closest("#add-records").find(".validate"),function(b){if(save){if(!this.validate_input($(b).attr("name"),$(b).val(),"popup",$(b),true)){save=false}}},this);if(save){this.model.set("hostname",this.model.get("hostname")+"."+window.domain_name);this.model.set("create_date",JSON.stringify(new Date()));$(".popover").remove();r=this.model.save({},{error:_.bind(function(c,b){this.add_error(c,b)},this),success:_.bind(function(c,b){this.add_success()},this),async:false});if(r.status==200){this.collection.add(this.model);tr=new NsregistrationRow({model:this.model});this._rowPointers[this.model.cid]=tr;$("#add-records").remove();$(this.el).find("div.main-table").append(tr.render().el);$(this.el).find("div.main-table").append(_.template($("#nsregistration-add-row").html())({}))}}},add_success:function(c,b){if(window.has_dns){var a=this.model.get("hostname");var f={async:false,action:"add_host_ip_dns",ip:this.model.get("ip")};$.post("/ajax/domain_management/sync_domain/"+window.domain_name+"/"+a,f,{},"json").done(function(h,i,g){})}},add_error:function(b,a){if(r=JSON.parse(a.responseText)){$("#add-records").remove();$(this.el).find("div.main-table").append(_.template($("#nsregistration-add-row").html())(this.model.toJSON()));if(r.errors){for(attr in r.errors[0]){a={val:false,error:r.errors[0][attr]};if(attr=="host"){attr="name"}target=$('#add-records  [name="'+attr+'"]');this.update_popup_validation(target,a);return}}else{if(r.error){a={val:false,error:r.error};target=$("#add-records");this.update_popup_validation(target,a);return}}}}});WebsitebuilderRow=RegistrarView.extend({tagName:"div",template:function(a){if($("#websitebuilder-row").length){return _.template($("#websitebuilder-row").html())(a)}return false},render:function(a){this.jEl().html(this.template(this.model.toJSON()));return this}});WebsitebuilderView=RegistrarView.extend({el:$("#websitebuilder"),b_tracked:false,initialize:function(){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(a){if(this.collection.length>0){$("#manage_websitebuilder_link a").html("Manage Website Builder Accounts")}else{$("#manage_websitebuilder_link a").html("");$("#websitebuilder").addClass("none");$("#nowebsitebuilder").removeClass("none")}this.jEl().find("div.main-table").html("");this._rowPointers=[];this.collection.models=_.sortBy(this.collection.models,function(b){return b.get("id")});_.each(this.collection.models,function(b){tr=new WebsitebuilderRow({model:b});this._rowPointers[b.cid]=tr;if(!this.b_tracked){this.track_product(b.get("type"));this.b_tracked=true}this.jEl().find("div.main-table").prepend(tr.render().el)},this);return this},track_product:function(a){var b="";if(window.basekit_pkgs[a]){b=window.basekit_pkgs[a]["package"]}if(mixpanel){mixpanel.track("Name.com account builder link",{env:"enomlive",brand:"Name.com",subscriptionPackageRef:b})}}});BulkEditView=RegistrarView.extend({template:function(a){if($("#bulk-action").length){return _.template($("#bulk-action").html())(a)}return false},el:$("#bulk-action-row"),render:function(a){this.jEl().html(this.template({domain_total:this.options.total,domain_count:this.collection.length,action:this.options.action,action_display:this.options.action_display}));_.each(this.collection.models,function(b){bi=new BulkActionItem({model:b});this.jEl().find("tbody").append(bi.render().el)},this);return this}});BulkActionItem=RegistrarView.extend({tagName:"tr",template:function(a){if($("#bulk-action-item").length){return _.template($("#bulk-action-item").html())(a)}return false},render:function(a){this.jEl().html(this.template(this.model.toJSON()));return this}});DnsTemplateView=RegistrarView.extend({el:$("#bulk-action-row"),template:function(a){if($("#dns-templates").length){return _.template($("#dns-templates").html())(a)}return false},initialize:function(a){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(){if(this.selected_template==undefined){first=_.first(this.collection.models);this.selected_template=first.get("id");selected=first.get("id")}else{selected=this.selected_template}$(this.el).html(this.template({dns_templates:this.collection,selected:selected}));return this},events:{"change #template_select":"select_template"},bulk_confirm:function(a){var b={};_.each(this.jEl().find("input.addl_config"),function(f){var c=$(f);b[c.attr("name")]=c.val()});this.collection.get($("#template_select").val()).save({additional_configs:b},{error:_.bind(function(f,c){this.error(f,c)},this),async:false})},select_template:function(a){this.selected_template=$(a.target).val();this.render()},error:function(c,a){this.collection.fetch();if(r=JSON.parse(a.responseText)){messages=[];if(typeof r.errors!="undefined"){if(typeof r.errors=="string"){StickyAlerts.alert({type:"error",heading:"ERROR:",message:r.errors})}else{_.each(this.collection.get(selected).get("add_records"),function(f,g){if((errors=r.errors.add[g])||(errors=r.errors.add.all)){m="";if(!errors){m="An unexpected Error occured."}else{_.each(errors,function(h){m+=h})}messages.push({domain:f.name,response:f.content,message:m,error:1})}else{messages.push({domain:f.name,response:f.content,message:"Success",error:0})}});_.each(this.collection.get(selected).get("rem_records"),function(f,g){if(r.errors&&r.errors["delete"]&&(errors=r.errors["delete"][g])){m="";if(errors){m="An unexpected Error occured."}else{_.each(r.errors["delete"][g],function(h){m+=h})}messages.push({domain:f.name,response:f.content,message:m,error:1})}else{messages.push({domain:f.name,response:f.content,message:"Success",error:0})}});$("#bulk-error").find(".modal-body p").html(_.template($("#error-messages").html())(messages));$("#bulk-error").modal("show")}}else{var b="Oops! An unexpected error occured.";if(typeof r.error!="undefined"){b=r.error}StickyAlerts.alert({type:"error",heading:"ERROR:",message:b})}}}});SearchCollection=RegistrarCollection.extend({append:function(a){if(a.original_renewal_price&&a.original_renewal_price==a.renewal_price){a.original_renewal_price=null}this.domains=this.domains?this.domains:{};if(this.domains[a.name]){this.update_domain(a.name);_.each(a,function(c,b){if(!_.isObject(c)&&!_.isFunction(c)){this.domains[a.name][b]=c}if(b=="products"||b=="area_position"){this.domains[a.name][b]=this.domains[a.name][b]?this.domains[a.name][b]:{};_.each(c,function(g,f){this.domains[a.name][b][f]=g},this)}},this)}else{this.domains[a.name]=a}this.latest_domain=a.name;this.trigger("append",a.name)},set_as_empty:function(a){this.domains={};this.trigger("set_as_empty",a)},get_latest_domain:function(){var a=this.domains[this.latest_domain];if(!a){a={}}return a},get_length:function(){return _.size(this.domains)},sort:function(b,a){var c=[];_.each(this.domains,function(g,f){c.push([f,g])});c.sort(function(g,f){var i;var h;if(typeof g[1][b]=="undefined"){i=0}else{i=g[1][b]}if(typeof f[1][b]=="undefined"){h=0}else{h=f[1][b]}if(b=="price"&&typeof g[1][b]=="undefined"&&typeof f[1][b]=="undefined"){if(typeof g[1].products!="undefined"){i=g[1].products[_.first(_.keys(g[1].products))]["price"]}if(typeof f[1].products!="undefined"){h=f[1].products[_.first(_.keys(f[1].products))]["price"]}}if(isNaN(i)&&isNaN(h)){if(i<h){return(a=="asc")?-1:1}if(i>h){return(a=="asc")?1:-1}return 0}else{if(a=="asc"){return i-h}else{return h-i}}});this.set_as_empty();_.each(c,function(f){this.append(f[1])},this)},update_domain:function(a){}});SearchModel=RegistrarModel.extend({add_cart:function(b){var b=b?b:{};var a=this;a.cart_enabled=false;this.in_cart=true;this.cart.namecom_ShoppingCart("addItem",{type:this.type,domain:this.name,period:this.period,tag:b.tag,extended:b.extended},true,function(c){if(!c["0"]["success"]){StickyAlerts.alert({type:"error",heading:"ERROR:",message:"Oops! There was a problem adding the product to your shopping cart."});a.rem_cart()}else{a.cart_enabled=true}});a.trigger("add_cart",a.name)},rem_cart:function(){var a=this;a.cart_enabled=false;this.in_cart=false;this.cart.namecom_ShoppingCart("removeItem",{type:this.type,domain:this.name,period:this.period},true,function(b){if(!b["0"]["success"]){StickyAlerts.alert({type:"error",heading:"ERROR:",message:"Oops! There was a problem removing the product to your shopping cart."});a.add_cart()}else{a.cart_enabled=true}});a.trigger("rem_cart",a.name)}});MakeOfferView=RegistrarView.extend({el:$("#makeoffer-modal"),render:function(b){var a=_.pairs(this.model.products)[0][1];this.jEl().html(_.template($("#offer-body").html())({domain:this.model,product:a}));this.jEl().modal("show")},events:{"submit form":"submit"},submit:function(b){b.preventDefault();var c=true;var a={};$(b.target).find("input").each(function(){var f=$(this);var g=f.val();a[f.attr("name")]=g;if(g){f.next(".help-inline").html("").closest(".control-group").removeClass("error")}else{f.next(".help-inline").html("Required").closest(".control-group").addClass("error");c=false}});if(c){this.submit_offer(a)}},submit_offer:function(b){var a=this;$.post("/ajax/makeoffer",b).done(function(c){$(".modal-body").html("Hey, thanks for your interest in this domain name. A sales representative will be in touch with you in the next 1-3 business days, but you can also call +1.425.298.2275 if you'd like to talk with someone right away.")}).fail(function(c){c=JSON.parse(c.responseText);_.each(c.errors,function(g,f){a.jEl().find('input[name="'+f+'"]').next(".help-inline").html(g).closest(".control-group").addClass("has-error")});if(c.message){StickyAlerts.alert({type:"error",heading:"ERROR:",message:c.message})}})}});var Discounts={domains:{},slds:{registration:{}},update_discounts:function(b,a){this.update_slds(b,a);this.apply_discounts(b.sld,a)},apply_discounts:function(b,a){if(!this.amounts[a]){return}if(!b){return}_.each(this.domains,function(g){if(g.products&&g.products[a]&&this.amounts[a][g.tld]){var f=g.products[a].original_price;if(this.slds[a][b]){var c=1;if(this.slds[a][b][g.tld]){c=2}if(_.size(this.slds[a][g.sld])>=c){f=f-this.amounts[a][g.tld]}}g.products[a].price=f;g.trigger("rerender")}},this)},update_slds:function(b,a){if(!this.slds[a]){return}if(b&&b.products&&b.products[a]){if(b.products[a].in_cart){this.slds[a][b.sld]=this.slds[a][b.sld]?this.slds[a][b.sld]:{};this.slds[a][b.sld][b.tld]=b.tld}else{if(this.slds[a][b.sld]&&this.slds[a][b.sld][b.tld]){delete this.slds[a][b.sld][b.tld]}}}}};RegistrarSearch=RegistrarView.extend({el:$("#registrar-search"),url:"/api/search/",events:{"click #search-start":"navigate","keyup #search-keyword":"enter_key"},page_forward:function(a){this.data.page++;this.attempts=25;if(this.info.tlds_left){this.fetch("start")}},enter_key:function(a){if(this.enter_key_hit(a)){this.navigate()}},navigate:function(a){if(typeof this.data!="undefined"){this.data.page=0}app.navigate("/"+$("#search-keyword").val(),{trigger:true})},start:function(a){if(this.update_search_data){this.update_search_data(a)}this.data=this.search_data;this.data.keyword=$.trim($("#search-keyword").val());if(!this.data.keyword){if(typeof this.data.allow_no_search_term=="undefined"||!this.data.allow_no_search_term){return}if(this.data.keyword_override){this.data.keyword=this.data.keyword_override}}_.each(this.views,function(b,c){this.views[c].undelegateEvents()},this);this.collection=new SearchCollection();this.views={};_.each(this.view_names,function(b){this.views[b]=new window[b]({collection:this.collection});this.views[b].zero_state()},this);$(".postsearch").show();$(".presearch").hide();$("#search-keyword").blur();this.info={};this.attempts=0;if(this.data.search_id){this.data.search_id=0}this.fetch("start");this.post_start()},post_start:function(){},fetch:function(a){var b=this;if(a=="poll"&&!b.data.search_id){setTimeout(function(){b.fetch("poll")},b.getThrottleTime())}else{$.ajax({type:"POST",url:b.url+a,data:b.data,success:function(f){if(!b.domains){b.domains={}}if(!b.info){b.info={}}if(a=="poll"){if(b.data.search_id!=f.info.search_id){return}var g="";_.each(f.domains,function(i,h){_.extend(i,SearchModel);g=i.sld;b.collection.append(i);var i=b.collection.domains[i.name];Discounts.update_slds(i,"registration");if(Discounts.amounts.registration[i.tld]){Discounts.domains[i.name]=i}},b);var c=f.ending_tld_domain;if(c&&b.ending_tld_collection&&!b.ending_tld_collection.domains){_.extend(c,SearchModel);b.ending_tld_collection.append(c)}b.collection.trigger("render_waiting_results");Discounts.apply_discounts(g,"registration");_.each(f.info,function(i,h){b.info[h]=i},b);_.each(b.views,function(h){if(h.post_poll){h.post_poll()}});if(!b.info.done){b.attempts++;setTimeout(function(){b.fetch("poll")},b.getThrottleTime())}else{b.start_retry_count=0;if(b.need_page_results()&&g!=="0"){b.page_forward()}else{_.each(b.views,function(h){if(h.cleanup){h.cleanup()}})}}}else{b.data.search_id=f.search_id;b.data.search_tracking_id=f.search_tracking_id;b.data.person_name=f.person_name;if(typeof f.domain_count!="undefined"){b.data.domain_count=f.domain_count}setTimeout(function(){b.fetch("poll")},b.getThrottleTime())}},error:function(c){if(c.status==420){b.enhance_your_calm();b.response=null}else{if(c.status==500||c.status==403){e={};if(c.responseText){e=JSON.parse(c.responseText)}if(e.redirect){redirect("?keyword="+b.data.keyword)}else{if(e.redirect_url){redirect(e.redirect_url)}else{if(b.data.keyword){redirect("?keyword="+b.data.keyword)}else{redirect(b.root)}}}}else{if(b.start_retry_enabled){if(_.size(b.collection.domains)<10&&b.start_retry_count<2){b.start_retry_count++;b.start()}}}}}})}return b.response},start_retry_count:0,start_retry_enabled:1,need_page_results:function(){return false},getThrottleTime:function(){if(this.attempts==0){return 100}if(this.attempts<=9){return 100}if(this.attempts<=19){return 200}if(this.attempts<=24){return 300}if(this.attempts<=29){return 500}return 2000}});SearchResultView=RegistrarView.extend({initialize:function(){this.registrar_initialize();this.model.bind("add_cart",this.add_cart,this);this.model.bind("rem_cart",this.rem_cart,this);this.model.bind("rerender",this.render,this)},bundle_items:[],toggle_cart:function(a){a=a?a:{};if(a.action=="add"){this.model.add_cart(a)}else{this.model.rem_cart(a)}},area_name:"default",template:function(a){if($("#"+this.area_name+"-domain").length){return _.template($("#"+this.area_name+"-domain").html())(a)}return false},product_cart_action:function(c){var b=$(c.target).closest(".product-cart-action");if(b.hasClass("disabled")||b.find(".makeoffer").length){return}if($(c.target).hasClass("checkout-link")){setTimeout(function(){redirect("/account/checkout")},200);return}var a=b.attr("data-producttype");if(!a){a=this.jEl().find(".producttype").val()}this.cart_toggle(a)},post_toggle:function(c,a,b){},cart_toggle:function(c){var f="";var b={};_.each(this.model.products,function(g){if(g.type==c){f=g.in_cart?"removeItem":"addItem";this.model.products[c].in_cart=(g.in_cart+1)%2;b[g.type]=g.type;Discounts.update_discounts(this.model,c)}else{if(g.in_cart){this.model.products[g.type].in_cart=0;b[g.type]=g.type}}},this);this.model.cart_disabled=1;this.model.trigger("rerender cart_toggle");var a=this;Cart.namecom_ShoppingCart(f,this.get_cart_item(c));_.each(a.bundle_items,function(g){Cart.namecom_ShoppingCart(f,{type:g.type,domain:a.model.name,period:a.duration?a.duration:1,tag:ptag,position:position,version:a.search_data.version})},a);Cart.namecom_ShoppingCart("sync",function(g){if(!g["0"]["success"]){var h="Oops! There was a problem "+(f=="addItem"?"adding":"removing")+" the product to your shopping cart.";StickyAlerts.alert({type:"error",heading:"ERROR:",message:h});_.each(b,function(i){a.model.products[i].in_cart=(a.model.products[i].in_cart+1)%2},a);a.model.cart_disabled=0;a.model.trigger("rerender cart_toggle");Discounts.update_discounts(a.model,c)}else{$(".product-cart-action").removeClass("disabled");a.post_toggle(c,a.model.tld,f)}})},get_cart_item:function(h){var g=this.search_data.tracking_type+"-"+this.search_data.version+"-"+this.area_name;if(this.result_type){var f=this.model.tag_override?this.model.tag_override:this.result_type;g=g+"-"+f}if(!this.model.area_position||!_.isObject(this.model.area_position)){this.model.area_position={}}var a;if(this.position_name){a=this.model.area_position[this.position_name]?this.model.area_position[this.position_name]:0}else{a=this.model.area_position[this.result_type]?this.model.area_position[this.result_type]:0}if(typeof this.model.position_override!="undefined"){a=this.model.position_override}var c=(this.model.products[h].premium||this.model.products[h].registry_premium==1)?1:0;var b=this.search_data.search_tracking_id?this.search_data.search_tracking_id:this.data.search_tracking_id;return{type:h,domain:this.model.name,period:this.model.products[h].duration,tag:g,position:a,version:this.search_data.version,search_tracking_id:b,is_premium:c}},make_offer:function(a){if(!this.offer){this.offer=new MakeOfferView({model:this.model})}this.offer.render();var b=$(a.target);if(b.attr("ga-action")){_gaq.push(["_trackEvent","Make an Offer",b.attr("ga-action"),b.attr("ga-label")])}},events:{"click .product-cart-action":"product_cart_action","click .makeoffer":"make_offer"}});SearchView=RegistrarView.extend({initialize:function(){this.collection.bind("append",this.append_result,this);this.collection.bind("set_as_empty",this.empty_result,this)}});function removeDisabledAttribute(a){$("#"+a).attr("disabled",false)}StickyAlert=RegistrarView.extend({tagName:"div",template:_.template("<a class='pull-right closealert pointer'><i class='fa fa-times colorwhite'></i></a><div class='row'><div class='inlineblock pull-left'><p class='nomargin'><i class='fa fa-stickyalert fa-2x'></i></p></div><div class='inlineblock pull-left padding12sides'><p class='nomargin'><strong class='heading'><%= heading%></strong> <span class='message'><%= message%></span></p></div></div>"),events:{"click .closealert":"close_alert"},render:function(b){var a=(b.type==="error")?"stickyalert-error":"stickyalert-"+b.type;this.jEl().html(this.template(b)).addClass("none "+a+" stickystyles");return this},show_alert:function(){var a=(new Date().getTime())+Math.floor((Math.random()*10000)+1);this.jEl().attr("id",a);this.jEl().slideDown("fast");setTimeout("hideAlert("+a+")",10000)},close_alert:function(){var a=this.jEl().attr("id");hideAlert(a)}});function hideAlert(a){$("#"+a).slideUp("fast")}StickyAlerts=RegistrarView.extend({el:$("#sticky-alerts"),views:[],initialize:function(){},alert:function(a){sa=new StickyAlert();this.jEl().append(sa.render(a).el);sa.show_alert()},});StickyAlerts=new StickyAlerts();AccountModel=RegistrarModel.extend({defaults:{},urlRoot:"/api/v3/account/"});RenewalNoticesSettingsArea=RegistrarView.extend({el:$("#renewal_notices_rapper"),model:AccountModel,template:function(a){if($("#renewal_notices_account_setting").length){return _.template($("#renewal_notices_account_setting").html())(a)}return false},render:function(){this.jEl().find(".settings").html(this.template(this.model.toJSON()));if(!this.model.get("extended")||!_.size(this.model.get("extended"))){this.jEl().find(".looks-good").show()}$("#tooltip_monthly_renewal_disabled").tooltip({placement:"right",delay:{hide:500}});return this},initialize:function(){this.model.fetch();this.model.bind("reset",this.render,this);this.model.bind("change",this.render,this);this.model.bind("add",this.render,this);this.model.bind("remove",this.render,this);this.model.bind("sync",this.render,this)},toggle_checkbox:function(a){$(this.el).addClass("disabled");name=a.target.name;checked=a.target.checked;extended_bool=!checked;extended=this.model.get("extended");extended[name]=extended_bool;this.model.set("extended",extended);this.model.save();$(this.el).removeClass("disabled");this.jEl().find(".looks-good").hide();this.jEl().find(".saved-settings").hide().fadeIn(300);this.post_update()},confirm_settings:function(){this.model.set("extended",{expiring_notification_day_before_disabled:0});this.model.save();this.jEl().find(".looks-good").hide();this.jEl().find(".saved-settings").hide().fadeIn(300);this.post_update()},post_update:function(){},events:{"change input[type=checkbox]":"toggle_checkbox","click .confirm-settings":"confirm_settings"}});window.ui_lookups={registration:{name:"Registration",text:"Your domain is available!",button:"Add to Cart",class_name:"btn-success",short_button:"Add",short_class:"btn-success",label:""},delete_list:{name:"Backorder",textcolor:"colorred",text:"This domain is taken!",button:"Backorder",class_name:"btn-primary",short_button:"Backorder",short_class:"btn-primary",tooltip:"By placing a backorder you'll greatly increase your chances of securing the domain name if/when the current owner allows it to expire. You can cancel your backorder at any time and receive a full refund.",label:"Backorder"},expiring_internal:{name:"Expiring Domain",text:"This domain is expiring!",button:"Add to Cart",class_name:"btn-success",short_button:"Expiring",short_class:"btn-success",special_price:"1",tooltip:"This domain is currently registered but expiring, so it is available for purchase. You can add it to your cart and proceed through checkout just like any other available domain. Renewals will be at our standard rate.",label:"Expiring"},internal_premium:{name:"Premium",text:"This is a premium domain!",button:"Add to Cart",class_name:"btn-success",short_button:"Premium",short_class:"btn-success",special_price:"1",tooltip:"Premium Domains are domains that are already registered but are being resold by the current owner. They can be purchased just like any other domain, and will renew at our standard rate.",label:"Premium"},buy_domains:{name:"Premium",text:"This is a premium domain!",button:"Add to Cart",class_name:"btn-success",short_button:"Premium",short_class:"btn-success",special_price:"1",tooltip:"Premium Domains are domains that are already registered but are being resold by the current owner. They can be purchased just like any other domain, and will renew at our standard rate.",label:"Premium"},sedo_domains:{name:"Premium",text:"This is a premium domain!",button:"Add to Cart",class_name:"btn-success",short_button:"Premium",short_class:"btn-success",special_price:"1",tooltip:"Premium Domains are domains that are already registered but are being resold by the current owner. They can be purchased just like any other domain, and will renew at our standard rate.",label:"Premium"},rightside_make_offer:{name:"Platinum",text:"This Premium Domain is available!",button:"Make Offer",class_name:"btn-success",short_button:"Platinum",short_class:"btn-success",special_price:"1",label:"Premium",offer_copy:"Congratulations, you have just found one of our favorite domains! Give us a call at 425.298.2275 or submit an offer using the form below to get things started.",minumum_offer:"1,000",button_extra_text:"Reserved Premium Domain"},enom_make_offer:{name:"Platinum",text:"This Premium Domain is available!",button:"Make Offer",class_name:"btn-success",short_button:"Premium",short_class:"btn-success",special_price:"1",label:"Premium",offer_copy:"This premium name may be available for purchase. Please submit an offer below and you will be contacted by a sales representative shortly.  Your information will only be used to contact you about this domain and will not be used for any other solicitation.  Need help instantly? Give us a call at +1.720.684.5872",minumum_offer:"1,000",button_extra_text:"Premium Domain"},landrush_eap:{name:"Early Access",button:"Buy Now",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},landrush_auction_a:{name:"Priority Pre-Registration",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},landrush_reserve_a:{name:"Early Access",button:"Buy Now",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},sunrise_reserve_a:{name:"Trademark Holder",button:"Buy Now",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},sunrise_auction_a:{name:"Trademark Holder",button:"Buy Now",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_reserve_a:{name:"Priority Pre-Registration",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_auction_a:{name:"Priority Pre-Registration",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_1:{name:"EAP Stage 1",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_2:{name:"EAP Stage 2",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_3:{name:"EAP Stage 3",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_4:{name:"EAP Stage 4",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_5:{name:"EAP Stage 5",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_6:{name:"EAP Stage 6",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_landrush_eap_reserve_7:{name:"EAP Stage 7",button:"Add Priority",short_button:"Add Priority",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},pre_ga_reserve:{name:"Pre-Registration",button:"Preorder",short_button:"Preorder",short_class:"btn-success",label:"Preorder",class_name:"btn-primary"},matching_sld:{name:"Matching Registration",button:"Buy Now",short_button:"Add to Cart",short_class:"btn-success",label:"Preorder",class_name:"btn-success"}};RegistrarSocial={share_data:{},shared:function(a,f,c){var b=this;$.ajax({type:"POST",url:"/ajax/social/shared/"+a+"/"+f,async:false,data:c,success:function(g){c=JSON.parse(g);c=c?c:{};if(b[f]){return b[f](c)}},error:function(i){var h="An unexpected error occured. Please try again.";var g={};if(i.responseText){g=$.parseJSON(i.responseText);if(g.sticky){h=g.sticky}}StickyAlerts.alert({type:"error",heading:"ERROR:",message:h})}})}};AccountSearchSettings=RegistrarModel.extend({url:"/api/v3/searchsettings/",defaults:{compact_search_results:false,},});Backbone.View.prototype.close=function(){this.undelegateEvents();this.jEl().empty();return this};AccountNote=RegistrarModel.extend({defaults:{model_name:"accountnotes",},urlRoot:"/api/v3/account/",initialize:function(a,b){if(a){this.urlRoot=this.urlRoot+a.account_id+"/accountnotes/?"}},});AccountNoteCollection=RegistrarPager.extend({model:AccountNote,url:"/api/v3/account/",defaults:{account_id:"",},initialize:function(b,a){this.paginator_core=_.clone(this.paginator_core);this.paginator_ui=_.clone(this.paginator_ui);this.paginator_ui.perPage=200;this.server_api.order="id";this.paginator_core.url=this.url+a.account_id+"/accountnotes/?"}});AccountNoteView=RegistrarView.extend({tagName:"div",className:"row notesrow",template:function(a){if($("#account-note-item").length){return _.template($("#account-note-item").html())(a)}return false},events:{},initialize:function(){this.model.bind("reset",this.render,this)},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});AccountNoteCollectionView=RegistrarView.extend({el:$("#div_notes"),initialize:function(){this._rowPointers=[];this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this)},render:function(a){_.each(this.collection.models,function(b){pre=new AccountNoteView({model:b});this._rowPointers[b.cid]=pre;this.jEl().append(pre.render().el)},this);$("#notesmodal").modal("show");return this}});AddNoteView=RegistrarView.extend({el:$("#div_add_note"),template:"",view_template:function(a){if($("#add-note-template").length){return _.template($("#add-note-template").html())(a)}return false},events:{"click .btn-add-note":"add","keyup #remote_addr":"processKey",},initialize:function(){this.template=this.view_template;this.render()},processKey:function(a){if(a.which===13){this.add(a)}},add:function(f){f.preventDefault();var a={};a.success=_.bind(function(h,g){this.success(g)},this);a.error=_.bind(function(h,g){this.error(g)},this);var c=true;_.each($(f.target).parent().parent().parent().find(".validate"),function(g){if(!this.validate_input($(g).attr("name"),$(g).val(),"inline",$(g),true)){c=false}},this);if(c){var b=this.model.save({},a)}},success:function(b){var a=new AccountNote(b);acct_note_view=new AccountNoteView({model:a});$("#div_notes").append(acct_note_view.render().el);this.model=new AccountNote({account_id:a.get("account_id")},[]);this.render()},error:function(a){var b="There was an error trying to add this note.";if(r=JSON.parse(a.responseText)){if(r.errors){for(id in r.errors){for(attr in r.errors[id]){b=r.errors[id][attr]}}}}StickyAlerts.alert({type:"danger",heading:"",message:b})},render:function(){this.jEl().html(this.template());return this}});RecItem=RegistrarModel.extend({defaults:{model_name:"",url:"",type:"",item_type:"domain",price:"",renewal_price:"",domain_name:"",in_cart:0,},});RcmdItemsCollection=RegistrarCollection.extend({model:RecItem,url:"",defaults:{title:"",category:"",item_type:"",},initialize:function(b,a){this.title=a.title;this.url=a.url;this.category=a.category},});RcmdItemView=RegistrarView.extend({template:function(a){if($("#single_item").length){return _.template($("#single_item").html())(a)}return false},events:{"click .product-cart-action":"product_cart_action"},render:function(a){this.jEl().html(this.template(this.model.toJSON()));return this},initialize:function(){this.model.bind("rerender",this.render,this)},product_cart_action:function(c){var b=$(c.target).closest(".product-cart-action");if(b.hasClass("disabled")){return}if($(c.target).hasClass("checkout-link")){setTimeout(function(){redirect("/account/checkout")},200);return}var a=b.attr("data-producttype");if(!a){a=this.jEl().find(".producttype").val()}this.cart_toggle(a)},cart_toggle:function(b){var f=this.model.get("in_cart");var c=f?"removeItem":"addItem";this.model.set("in_cart",(f+1)%2);this.model.cart_disabled=1;this.model.trigger("rerender");var a=this;Cart.namecom_ShoppingCart(c,this.get_cart_item(b));Cart.namecom_ShoppingCart("sync",function(g){if(!g["0"]["success"]){var h="Oops! There was a problem "+(c=="addItem"?"adding":"removing")+" the product to your shopping cart.";StickyAlerts.alert({type:"error",heading:"ERROR:",message:h});a.model.set("in_cart",0);a.model.cart_disabled=0;a.model.trigger("rerender")}else{$(".product-cart-action").removeClass("disabled")}})},get_cart_item:function(b){var a=0;return{type:b,domain:this.model.get("domain_name"),period:this.model.get("duration"),tag:"recommendations-landing",is_premium:this.model.get("is_premium"),}},});RcmdItemsCollectionView=RegistrarView.extend({el:"",template:function(a){if($("#items_collection").length){return _.template($("#items_collection").html())(a)}return false},initialize:function(a){this.collection.bind("reset",this.render,this);this.collection.bind("sync",this.render,this);if(a.el){this.setElement(a.el)}},render:function(a){if(this.collection.length>0){this.jEl().html(this.template({title:this.collection.title}));var b=this.jEl().show().find(".owl-slide");_.each(this.collection.models,function(g){var h=new RcmdItemView({model:g});b.append(h.render().el)},this);var c=b;c.owlCarousel({scrollPerPage:true,items:4,itemsDesktop:[1200,4],itemsDesktopSmall:[992,2],itemsTablet:[768,1],itemsMobile:[400,1]});$("#"+this.collection.category+" .nexttld").click(function(){c.trigger("owl.next");_gaq.push(["_trackEvent","Recommendations Page","Scroll Next","products"])});$("#"+this.collection.category+" .prevtld").click(function(){c.trigger("owl.prev");_gaq.push(["_trackEvent","Recommendations Page","Scroll Previous","products"])})}var f=0;this.jEl().find(".owl-item .item .fullwidth .shadowbox .heightclass").each(function(){if($(this).height()>f){f=$(this).height()}});this.jEl().find(".owl-item .item .fullwidth .shadowbox .heightclass").height(f);return this}});RecommendedDomain=SearchResultView.extend({className:"item",template:function(a){if($("#domain_item").length){return _.template($("#domain_item").html())(a)}return false},render:function(a){this.jEl().html(this.template({domain:this.model,area_name:this.area_name})).find(".onpage-tooltip").tooltip();if(this.box_height){$(this.el).find(".heightclass").height(this.box_height)}return this}});RecommendedView=SearchView.extend({el:"#account_domains",initialize:function(){this.collection.bind("append",this.append_result,this);this.collection.bind("render_waiting_results",this.render_waiting_results,this)},template:function(a){if($("#items_collection").length){return _.template($("#items_collection").html())(a)}return false},area_name:"account_recommendations",append_result:function(){var a=this.collection.get_latest_domain();if(a.area_position&&a.area_position[this.area_name]!=undefined){this.waiting_domains[a.area_position[this.area_name]]=a}},render_waiting_results:function(){var a=_.sortBy(this.waiting_domains,function(b){return parseInt(b.area_position[this.area_name])});_.each(a,function(g){delete this.waiting_domains[g.area_position[this.area_name]];if(!this.rendered_domains[g.name]){var c="";if(g.avail===1){c=_.pairs(g.products)[0][1].type}var b=new RecommendedDomain({model:g,type:c,area_name:this.area_name});b.options={type:c,area_name:this.area_name};b.area_name=this.area_name;b.position_name=this.area_name;var f=$(b.render().el);this.rendered_domains[g.name]=b;this.jEl().show().find(".owl-slide").append(f)}},this)},zero_state:function(){this.waiting_domains={};this.rendered_domains={};this.jEl().html(this.template({title:this.title}))},cleanup:function(){var b=this.jEl().find(".owl-slide");b.owlCarousel({scrollPerPage:true,items:4,itemsDesktop:[1200,4],itemsDesktopSmall:[992,2],itemsTablet:[768,1],itemsMobile:[400,1]});var c=0;this.jEl().find(".owl-item .item .fullwidth .shadowbox .heightclass").each(function(){if($(this).height()>c){c=$(this).height()}});_.each(this.rendered_domains,function(f){f.box_height=c;f.model.trigger("rerender")},this);var a=this;this.jEl().find(".nexttld").click(function(){b.trigger("owl.next");_gaq.push(["_trackEvent","Recommendations Page","Scroll Next",a.area_name])});this.jEl().find(".prevtld").click(function(){b.trigger("owl.prev");_gaq.push(["_trackEvent","Recommendations Page","Scroll Previous",a.area_name])})}});PaymentProfileView=RegistrarView.extend({name_mapping:{credit_card_number:"cardNumber",security_code:"cardValidationNumber",phone:"phoneNumber",first_name:"firstName",last_name:"lastName",address1:"address_1",address2:"address_2",},show_editcontact:function(a){this.jEl().find(".modaldetails").hide();this.jEl().find(".showeditcontact").show()},show_edit:function(a){this.jEl().find(".showeditprofile").modal("show")},save:function(b){b.preventDefault();this.model.set("expireDate",this.jEl().find('select[name="'+form_prefix+'expiration_date_year"]').val()+"-"+this.jEl().find('select[name="'+form_prefix+'expiration_date_month"]').val());this.model.set("country",this.jEl().find('select[name="'+form_prefix+'country"]').val());var a=true;_.each(this.jEl().find("form input"),function(g){var f=$(g);var c=f.attr("name").replace(form_prefix,"");if(this.name_mapping[c]!=undefined){c=this.name_mapping[c]}if(!this.validate_input(c,f.val(),"inline",f,true)){if(!f.is(":visible")){this.show_editcontact()}a=false}},this);if(a){this.apply_changes()}},apply_changes:function(){if(this.jEl().find(".saveprofile").hasClass("disabled")){return}this.disable_save();options={};options.error=_.bind(function(b,a){this.error(a)},this);if(this.model.get("new_profile")){options.success=_.bind(function(b,a){this.add_new_profile(a)},this)}else{options.success=_.bind(function(b,a){this.success(a)},this)}this.model.save(null,options)},disable_save:function(){this.jEl().find(".saveprofile").removeClass("btn-primary").addClass("disabled").html("Updating ...")},enable_save:function(){this.jEl().find(".saveprofile").addClass("btn-primary").removeClass("disabled").html("Update Profile")},success:function(a){this.jEl().find(".showeditprofile").modal("hide");this.enable_save();this.model.set("new_profile",false);this.model.trigger("updated");StickyAlerts.alert({type:"success",heading:"Success!",message:_.escape(this.model.get("alias"))+" has been updated successfully."});if(typeof app.PaymentProfilesArea!="undefined"){app.PaymentProfilesArea.create_pending(false)}},error:function(a){this.enable_save();var b={};if(a.responseText){b=$.parseJSON(a.responseText)}this.jEl().find(".help-inline").remove();if(b.error!=undefined){StickyAlerts.alert({type:"error",heading:"ERROR:",message:"Oops! "+b.error})}if(b.errors!=undefined){if(this.model.get("id")!=undefined){_.each(b.errors[this.model.get("id")],function(f,c){this.display_error(c,f)},this)}else{_.each(b.errors,function(f,c){_.each(f,function(h,g){this.display_error(g,h)},this)},this)}}},display_error:function(a,b){if(this.reverse_name_mapping[a]!=undefined){a=this.reverse_name_mapping[a]}var c=this.jEl().find('[name="'+form_prefix+a+'"]').closest("div.form-group, div.control-group");c.addClass("has-error").append('<div class="help-inline help-block">'+b+"</div>");if(!c.is(":visible")){this.show_editcontact()}}});ZenDeskFormView=RegistrarView.extend({el:".zendesk-form-container",create_ticket:function(g){g.preventDefault();var f=$(g.target);if(!f.hasClass("zendesk-form")){f=f.closest(".zendesk-form")}var b={};var a=true;_.each(f.find("input, select, textarea"),function(j,i){var l=$(j);if(!l.is(":file")){var n=l.val();if(l.hasClass("required")&&((l.attr("type")==="checkbox"&&!l.is((":checked")))||!n)){this.update_inline_validation(l,{val:false,error:"Required"});a=false}else{b[l.attr("name")]=n;this.update_inline_validation(l,{val:n})}}else{}},this);if(a){f.find('input[type="submit"]').attr("disabled",true).after('<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>');var c=this;var h=new FormData(f[0]);$.ajax({url:"/ajax/zendeskticket/create/",type:"POST",data:h,dataType:"json",contentType:false,cache:false,processData:false}).fail(function(j,l,k){f.find('input[type="submit"]').attr("disabled",false);f.find(".fa.fa-spinner").remove();var i={error:"An unexpected error occured. Please try again."};if(typeof j.responseText!="undefined"){i=$.parseJSON(j.responseText)}StickyAlerts.alert({type:"error",heading:"ERROR:",message:i.error});return true}).done(function(i,k,j){f.html('<div class="gigantictopmargin giganticbottommargin text-center"><strong>Thank you for submitting your ticket! One of our support agents will be in touch as soon as possible.</strong></div>');return true})}},events:{"submit form.zendesk-form":"create_ticket"}});function getPromoPrice(f,a){var g=f.premium?"premium":"non_premium";var c="";if(window.promo_products[g]&&window.promo_products[g][a]){if(window.promo_products[g][a][f.type]&&window.promo_products[g][a][f.type][f.duration]){var b=window.promo_products[g][a][f.type][f.duration];if(b.operator=="="){c=b.amount}if(b.operator=="*"){c=f.price*b.amount}if(b.operator=="-"){c=f.price-b.amount}if(b.operator=="+"){c=f.price+b.amount}}}return c}function getDisplayDate(b){if(!b){return""}var a=b.split(" ");d=new Date(a[0].replace(/-/g,"/"));s=d.toDateString();s=s.split(" ");return s[2]+" "+s[1]+" "+s[3]};