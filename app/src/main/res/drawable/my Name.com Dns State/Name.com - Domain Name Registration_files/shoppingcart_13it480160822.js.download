(function(c){function b(g,f,h){if(f!=undefined&&f==true){g.namecom_ShoppingCart("sync",h)}}function e(h,g,f){var i={};i.action=g;i.data=f;syncItems=h.data("syncItems");if(syncItems==undefined){syncItems=[]}syncItems.push(i);h.data("syncItems",syncItems)}var a={init:function(f){var g={fnEmptyCartCallback:function(){},fnPromoCallback:function(){},fnCheckoutCallback:function(){},fnPromoCodeValid:function(){},fnPromoCodeInvalid:function(){},fnForceRefresh:function(){window.refresh()},fnOnAjaxReturn:function(){},fnSyncStart:function(){},fnSyncEnd:function(){},fnPromoOverride:function(){},sAjaxUrl:"/ajax/checkout/sync",sAjaxPCIUrl:"/ajax/pci/checkout",sCartTotalPriceSelector:"span.price",sCartTotalDiscountedPriceSelector:".total",sCartTotalCountSelector:"span.cart-link span.count",sCartTotalSavingsSelector:".saved strong",sCartTotalSavingsContainer:".saved .amount",sCartTaxSelector:".tax",sCartTaxContainer:".tax-container",sCartPartialAccountCreditSelector:'[name="partial_account_credit"]',sCartPartialAccountCouponSelector:'[name="partial_account_coupon"]',sCartSubtotalSelector:".subtotal-container .subtotal",sCartSubtotalContainer:".subtotal-container",sPromoCodeInputSelector:"#promo",sPromoCodeApplySelector:"#promoApply",oPromoCodes:[]};opts=c.extend(g,f);return this.each(function(){var j=c(this);j.data("options",opts);var i=c(opts.sPromoCodeInputSelector);var h=c(opts.sPromoCodeApplySelector);h.click(function(k){k.preventDefault();j.namecom_ShoppingCart("applyPromo",{code:i.val()},true,function(l){if(l[0]["success"]){opts.fnPromoCodeValid(i)}else{opts.fnPromoCodeInvalid(i)}})})})},addItem:function(g,f,h){return this.each(function(){jThis=c(this);var i=jThis.data("options");e(jThis,"add",g);b(jThis,f,h)})},removeItem:function(i,f,h){var g;if(i instanceof Object==false){g={id:i}}else{g=i}return this.each(function(){jThis=c(this);var j=jThis.data("options");e(jThis,"remove",g);b(jThis,f,h)})},updateItem:function(g,f,h){return this.each(function(){jThis=c(this);var i=jThis.data("options");e(jThis,"update",g);b(jThis,f,h)})},setPromo:function(g,f,h){if(h==undefined){h=function(i){if(i["0"]["success"]==false){if(typeof StickyAlerts!="undefined"){StickyAlerts.alert({type:"error",heading:"ERROR:",message:i["0"]["message"]})}c(opts.sCartTotalSavingsSelector).html(toCurrency(0));return}}}return this.each(function(){jThis=c(this);var i=jThis.data("options");e(jThis,"set_promo",g);b(jThis,f,h);i.fnPromoCallback()})},applyPromo:function(g,f,h){if(h==undefined){h=function(i){if(i["0"]["success"]==false){var j="An error occured applying the promo code.";if(typeof i["0"]["message"]!="undefined"){j=i["0"]["message"]}if(typeof StickyAlerts!="undefined"){StickyAlerts.alert({type:"error",heading:"ERROR:",message:j})}return}}}return this.each(function(){jThis=c(this);var i=jThis.data("options");e(jThis,"promo",g);b(jThis,f,h);i.fnPromoCallback()})},empty:function(f){return this.each(function(){jThis=c(this);var g=jThis.data("options");e(jThis,"emptyCart",{});b(jThis,true,f);g.fnEmptyCartCallback()})},checkout:function(g,f,h){return this.each(function(){jThis=c(this);var j=jThis.data("processing");if(j){return}var i=jThis.data("options");if(f){g.order_id=jThis.data("order_id")}e(jThis,"checkout",g);jThis.data("processing",true);b(jThis,true,h);i.fnCheckoutCallback()})},instantCheckout:function(f){return this.each(function(){jThis=c(this);var g=jThis.data("options");e(jThis,"instant_checkout",{});b(jThis,true,f);g.fnCheckoutCallback()})},updateProfile:function(g,f,h){return this.each(function(){jThis=c(this);var i=jThis.data("options");e(jThis,"update_profile",g);jThis.data("processing",true);b(jThis,f,h)})},updateTld:function(f,g,h){return this.each(function(){jThis=c(this);var i=jThis.data("options");e(jThis,"update_tld_requirements",f);b(jThis,g,h)})},completePaypalTransaction:function(j,g,h,i){var f={completePaypal:true,order_id:j,paypal_token:g,type:"paypal"};return this.each(function(){jThis=c(this);var k=jThis.data("options");var l=jThis.data("processing");if(l){return}e(jThis,"checkout",f);jThis.data("processing",true);b(jThis,h,i)})},deleteProfile:function(i,f,h){var g={id:i};return this.each(function(){jThis=c(this);var j=jThis.data("options");e(jThis,"delete_profile",g);b(jThis,f,h)})},setDefaultProfile:function(i,f,h){var g={id:i};return this.each(function(){jThis=c(this);var j=jThis.data("options");e(jThis,"set_default_profile",g);b(jThis,f,h)})},phoneVerification:function(i,g,k,f,h,l){var j={phone_number:i,country_code:g,language:k,also_verify_contact:f};return this.each(function(){jThis=c(this);var m=jThis.data("options");e(jThis,"call_phone",j);b(jThis,h,l)})},verificationCode:function(i,g,f,h,k){var j={verification_code:i,also_verify_contact:f,reference_id:g};return this.each(function(){jThis=c(this);var l=jThis.data("options");e(jThis,"verify_phone_code",j);b(jThis,h,k)})},getCheckoutProgress:function(f){return this.each(function(){jThis=c(this);var h=jThis.data("progress_count");if(h==undefined){h=0}else{h++}var i={count:h,order_id:jThis.data("order_id")};jThis=c(this);var g=jThis.data("options");e(jThis,"checkout_progress",i);jThis.data("progress_count",h);b(jThis,true,f)})},removeItemsByTld:function(g,h,i){var f={tld:g};return this.each(function(){jThis=c(this);e(jThis,"remove_by_tld",f);b(jThis,h,i)})},removeItemsBySld:function(g,f,i){var h={sld:g};return this.each(function(){jThis=c(this);e(jThis,"remove_by_sld",h);b(jThis,f,i)})},sync:function(f){return this.each(function(){jThis=c(this);syncItems=jThis.data("syncItems");var h=jThis.data("options");var j={actions:syncItems};var g=h.sAjaxUrl;var i=jThis.data("processing");if(i){g=h.sAjaxPCIUrl}h.fnSyncStart();c.ajax({url:g,context:document.body,type:"POST",data:j,async:true,cache:false,error:function(k){h.fnSyncEnd();if(typeof k.responseText!="undefined"&&k.status!=420){var l=jQuery.parseJSON(k.responseText);if(l&&l.refresh){h.fnForceRefresh(l.message)}}},success:function(o){jThis.data("processing",false);h.fnOnAjaxReturn();if(o!=null){if(typeof o.key!="undefined"&&o.key=="force_refresh"){h.fnForceRefresh(o.message);return}var q=c(h.sCartPartialAccountCreditSelector).prop("checked");var m=c(h.sCartPartialAccountCouponSelector).prop("checked");var l=c('input[name="creditcard"]:checked').closest(".order-row").find(".row-head").hasClass("account-credit");var p=o.totals.total_with_tax;if(typeof p!="undefined"){c(h.sCartTotalPriceSelector).html(toCurrency(p))}var k=p;if(q){k=Number(p)-Number(o.discount_totals.discount_data.partial_account_credit)-Number(o.totals.tax)+Number(o.totals.partial_ac_tax)}else{if(l){k=Number(o.totals.price)-Number(o.totals.discount)}}if(m){k=Number(k-Number(c("#partial-account-coupon-amount").html()))}c(h.sCartTotalDiscountedPriceSelector).html(toCurrency(k));c(h.sCartTotalCountSelector).html(o.totals.count);jThis.data("subtotal_price",o.totals.price);jThis.data("total_price",p);jThis.data("savings",o.totals.discount);jThis.data("totals",o.totals);jThis.data("discount_totals",o.discount_totals);c("#header-dropdown .wishlist-count").html(o.totals.wishlist_count);if(o.totals.wishlist_count){c("#header-dropdown .wishlist-dropdown").show()}else{c("#header-dropdown .wishlist-dropdown").hide()}c(h.sCartSubtotalSelector).html(toCurrency(o.totals.price));c(h.sCartTotalSavingsContainer).html(toCurrency(o.totals.discount));var n=q?o.totals.partial_ac_tax:o.totals.tax;jThis.data("tax",n);c(h.sCartTaxSelector).html(toCurrency(n));if(n&&!l){c(h.sCartSubtotalContainer).removeClass("none");c(h.sCartTaxContainer).removeClass("none")}else{c(h.sCartTaxContainer).addClass("none")}if(o["0"]!=undefined&&o["0"]["order_id"]!=undefined){jThis.data("order_id",o["0"]["order_id"])}if(typeof o!="undefined"){for(d in o){if(typeof d.promo_override!="undefined"){h.fnPromoOverride(d.promo_override)}}}if(f!=undefined){f(o)}}h.fnSyncEnd()}});jThis.data("syncItems",[])})}};c.fn.namecom_ShoppingCart=function(f){if(a[f]){return a[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return a.init.apply(this,arguments)}else{c.error("Method "+f+" does not exist")}}}})(jQuery);